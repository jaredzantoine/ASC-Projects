webpackJsonp([15],{3688:function(e,t){(function(){"use strict";TS.registerModule("ui.email_healing",{onStart:function e(){n()},test:function e(){return{_correctEmailTypos:i}}});var e=0;var t={};var n=function e(){var t=$("body");t.on("input","[data-email-healing]",_.debounce(i,600));t.on("blur","[data-email-healing]",i)};var i=function n(){var i=this;var a=r(i.value);if(!TS.utility.email.validateEmail(a).is_valid)return;var o=TS.utility.email.correctTypos(a,false);if(!o.typo_corrected)return;var s=i.getAttribute("data-email-healing");if("true"===s){e+=1;s=e;i.setAttribute("data-email-healing",s)}if(void 0===t[s])t[s]={color:window.getComputedStyle(i).color,orange:this.getAttribute("data-email-healing-typo-color")||"#ffa800",green:this.getAttribute("data-email-healing-corrected-color")||"#2ab27b"};i.style.color=t[s].orange;i.style.transition="color 0.2s ease-out 0s";setTimeout(function(){i.value=o.updated_email;i.style.color=t[s].green;i.style.transition="color 0.2s ease-out 0s"},300);setTimeout(function(){i.style.color=t[s].color;i.style.transition="color 0.6s ease-out 0.3s"},500)};var r=function e(t){if(!t&&0!==t)return"";return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}})()},3689:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility.email",{ERROR_EMPTY:"empty",ERROR_INVALID:"invalid",ERROR_TOO_MANY:"too_many",EMAIL_REGEX:new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i"),DOMAIN_REGEX:new RegExp("^@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i"),convertToArray:function e(t){return t.replace(/\s|\n/g,"").replace(/,$/g,"").split(",")},validateEmail:function e(t,n){var r=TS.utility.email.convertToArray(t);return i(r,n)},validateDomain:function e(n){var i=n?TS.utility.email.convertToArray(n):[];return t(i)},correctTypos:function e(t,n){if(void 0===n)n=true;return s(t,n)},removeDuplicates:function e(t){return _.uniq(TS.utility.email.convertToArray(t)).join(",")},getErrorMessage:function t(n,i){return e[n]?e[n](i||{}):""},getTooManyErrorMessage:function t(n){return e[TS.utility.email.ERROR_TOO_MANY]({max_addresses:n})},test:function t(){return{error_messages:e,tld_typo:r,domain_typo:a}}});var e={empty:TS.i18n.t("Please fill in your email.","email_utility"),invalid:TS.i18n.t("Sorry, but that email is invalid.","email_utility"),too_many:TS.i18n.t("Please make your list shorter — we can check up to {max_addresses} addresses at a time.","email_utility"),invalid_domain:TS.i18n.t("Sorry, but that isn’t a valid email domain.","email_utility")};var t=function t(i){if(!Array.isArray(i))TS.error("Type error: TS.utility.email._validateDomain requires an array. domain_array is a","undefined"===typeof i?"undefined":n(i));var r=[];_.each(i,function(e){if(!TS.utility.email.DOMAIN_REGEX.test(e))r.push(e)});if(r.length){var a="invalid_domain";return{is_valid:false,email_domain:i,error_key:a,error_message:e[a](),error_domains:r}}return{is_valid:true,email_domain:i,error_key:"",error_message:""}};var i=function e(t,i){if(!Array.isArray(t))TS.error("Type error: TS.utility.email._validateEmail requires an array. email_array is a","undefined"===typeof t?"undefined":n(t));var r=0;var a=t.length;var o;var s;var l;if(i&&a>i){s=TS.utility.email.ERROR_TOO_MANY;if(i>1)l=TS.utility.email.getTooManyErrorMessage(i);else l=TS.utility.email.getErrorMessage(TS.utility.email.ERROR_INVALID);return{is_valid:false,email_array:t,error_key:s,error_message:l}}for(r;r<a;r+=1){o=t[r];if(!r&&""===o)s=TS.utility.email.ERROR_EMPTY;else if(!TS.utility.email.EMAIL_REGEX.test(o))s=TS.utility.email.ERROR_INVALID;if(s)return{is_valid:false,email_array:t,error_key:s,error_message:TS.utility.email.getErrorMessage(s)}}return{is_valid:true,email_array:t,error_key:"",error_message:""}};var r={cmo:"com",ocm:"com",con:"com","com.com":"com",vom:"com",cim:"com",cpm:"com",ccom:"com",coom:"com",comm:"com",cmm:"com"};var a={gmai:"gmail",gamil:"gmail",gmil:"gmail",gmial:"gmail",gmal:"gmail",gmaill:"gmail",gnail:"gmail",gamail:"gmail",gmsil:"gmail",yhoo:"yahoo",yahooo:"yahoo",yaho:"yahoo",homail:"hotmail",hotmaill:"hotmail",outook:"outlook",outlock:"outlook",otlook:"outlook",outlolk:"outlook"};var o={};var s=function e(t,n){if(void 0===n)n=true;var i=TS.utility.email.convertToArray(t);var r=t;var a=t;i.forEach(function(e){if(!n&&o[e])return;var t=l(e);if(t.has_typo){o[e]=true;r=r.replace(e,t.email_val);a=a.replace(e,t.shadow_val)}});return{typo_corrected:t!==r,shadow_email:a.replace(/\n/g,"<br />"),updated_email:r}};var l=function e(t){var n=t;var i;var o;_.forOwn(r,function(e,r){o=new RegExp("\\."+r+"$");if(o.test(t)){i=true;t=t.replace(o,"."+e);n=n.replace(o,'.<span class="seafoam_green">'+e+"</span>");return false}});_.forOwn(a,function(e,r){o=new RegExp("@"+r+"\\.");if(o.test(t)){i=true;t=t.replace(o,"@"+e+".");n=n.replace(o,'@<span class="seafoam_green">'+e+"</span>.");return false}});return{has_typo:i,email_val:t,shadow_val:n}}})()},4188:function(e,t){(function(){"use strict";TS.registerComponent("PresenceList",{_constructor:function e(t){this._list=[];this.added_sig=new signals.Signal;this.removed_sig=new signals.Signal;TS.presence_manager.addPresenceList(this);if(t)this.add(t)},add:function e(t){if(!_.isArray(t))t=[t];var n=_.difference(t,this._list);if(n.length){this._list=this._list.concat(n);this.added_sig.dispatch(n)}},remove:function e(t){if(!_.isArray(t))t=[t];var n=_.intersection(t,this._list);if(n.length){this._list=_.difference(this._list,n);this.removed_sig.dispatch(n)}},clear:function e(){this.removed_sig.dispatch(this._list);this._list=[]},destroy:function e(){this.removed_sig.dispatch(this._list);this._list=null}})})()},4192:function(e,t){(function(){"use strict";TS.registerModule("api.connection",{onStart:function e(){i=TS.qs_args.api_timings||TS.utility.enableFeatureForUser(n)},test:function n(){var r={};Object.defineProperty(r,"_should_send_timing_data",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(r,"_internet_connected_p",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(r,"_ms_reconnected_p",{get:function e(){return t},set:function e(n){t=n}});return r},waitForAPIConnection:function t(){if(e)return e;var n=arguments.length<=0||void 0===arguments[0]?1e3:arguments[0];var a=arguments[1];var o=0;var s="function"===typeof n?n():n;var l=s;var c=function e(t){if("number"===typeof a&&o>a){var n="Unable to reconnect to the API after "+o+" retry attempts";TS.warn(n);m.dispatch(new Error(n));return}if(o>0){var i=t?"unable to reach API":"browser says it is still offline";TS.warn("Internet connection still offline after "+o+" attempts ("+i+")")}o+=1;setTimeout(d,l)};var u=function e(){if(o>0){if(i)var t=TS.metrics.measureAndClear("api_offline_duration","api_connectivity_lost");var n=_.round(t/1e3,2);var r=o?"Internet connection has been re-established after "+o+" retry attempts;":"Internet connection has been re-established";var a=[r,"offline for "+n+" seconds"];TS.info(a.join(" "))}f.dispatch()};var d=function e(){if(false===window.navigator.onLine){var t=false;c(t);return}r(function(e){if(e)u();else{var t=true;c(t)}})};var f=new signals.Signal;var m=new signals.Signal;if(i)TS.metrics.mark("api_connectivity_lost");e=new Promise(function(t,n){f.addOnce(function(){e=void 0;t()});m.addOnce(function(e){n(e)});d()});return e},promiseToTestAPIConnection:function e(){return new Promise(function(e){r(function(t){e(t)})})},waitForMSToReconnect:function e(){if(TS.interop.SocketManager.isConnected())return Promise.resolve();if(!t)t=new Promise(function(e){TS.interop.SocketManager.connectedSig.addOnce(function(){t=void 0;e()})});return t}});var e;var t;var n=1;var i;var r=function e(t){var n=6e4;$.ajax({url:TS.model.api_url+"api.test",timeout:n}).then(function(e){var n=!!(e&&e.ok);t(n)}).fail(function(){t(false)})}})()},4193:function(e,t){(function(){"use strict";TS.registerModule("permissions",{})})()},4194:function(e,t){(function(){"use strict";TS.registerModule("permissions.channels",{canMemberJoinChannel:function e(t,n){if(!t||!n)return false;if(t.is_im||t.is_mpim)return true;if(n._is_local)return true;if(t.is_shared){var i=t.shared_team_ids;if(TS.shared.isModelObOrgShared(t)){if(TS.utility.teams.isMemberExternal(n))return false;if(t.is_global_shared)return true;var r=_.get(n,"enterprise_user.teams")||[];var a=_.intersection(r,i);if(a.length)return true}if(TS.shared.isModelObShared(t)){if(n._is_from_org)return false;var o=n.team_id;if(i.indexOf(o)>-1)return true}}return false},canMemberLeaveChannel:function e(t,n){if(!t||!n)return false;if(TS.channels.isChannelRequired(t)||n.is_restricted)return false;return true},canSeeShareChannelOption:function e(t){var n=!!_.get(t,"pending_shared.length");return(!t.is_shared||n)&&!t.is_general&&TS.permissions.members.canRequestSharedChannel()}})})()},4195:function(e,t){(function(){"use strict";TS.registerModule("permissions.enterprise",{canUserLeaveTeam:function e(t,n){if(!TS.boot_data.page_needs_enterprise)return false;if(t.is_restricted)return false;if(TS.boot_data.feature_lazy_grid_teams&&!TS.utility.teams.isMemberOnTeam(t,n))return false;if(!TS.boot_data.feature_lazy_grid_teams&&!TS.enterprise.isUserOnTeam(t,n))return false;return!!n.can_leave}})})()},4218:function(e,t){(function(){"use strict";TS.registerModule("utility.channels",{getPermissibleChannelName:function e(t){if("@"===t.charAt(0)||"#"===t.charAt(0)&&1===t.length||t.indexOf(",")>-1)return null;if(!(t&&/^.+$/.test(t)&&TS.permissions.members.canCreateChannels()))return null;var n=TS.utility.cleanChannelName(t.substring(0,21));if(!n||TS.channels.getChannelByName(n)||TS.groups.getGroupByName(n)||TS.members.getMemberByName(n))return null;return n}})})()},4219:function(e,t){TS.registerModule("constants",{onStart:_.noop,avatar_size_map:{20:{standard:"image_24",retina:"image_48"},24:{standard:"image_24",retina:"image_48"},32:{standard:"image_32",retina:"image_72"},36:{standard:"image_48",retina:"image_72"},48:{standard:"image_48",retina:"image_72"},64:{standard:"image_64",retina:"image_64"},72:{standard:"image_72",retina:"image_192"},192:{standard:"image_192",retina:"image_192"}}})},4222:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("rooms",{added_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_participants_sig:new signals.Signal,changed_date_end_sig:new signals.Signal,changed_channels_sig:new signals.Signal,onStart:function e(){},getRoomById:function e(t){return TS.rooms.getRoomByProp("id",t)},getRoomByProp:function e(t,n){if(!t)return null;var i=null;_.forOwn(TS.model.rooms,function(e){if(e[t]===n){i=e;return false}});return i},upsertAndSignal:function e(t){var n=TS.rooms.upsertRoom(t);if("CHANGED"===n.status){if(-1!=n.what_changed.indexOf("name"))TS.rooms.changed_name_sig.dispatch(n.room);if(-1!=n.what_changed.indexOf("participants"))TS.rooms.changed_participants_sig.dispatch(n.room);if(-1!=n.what_changed.indexOf("date_end"))TS.rooms.changed_date_end_sig.dispatch(n.room);if(-1!=n.what_changed.indexOf("channels"))TS.rooms.changed_channels_sig.dispatch(n.room)}else if("ADDED"===n.status)TS.rooms.added_sig.dispatch(n.room);return n},upsertRoom:function t(i){var r=TS.model.rooms;var a=TS.rooms.getRoomById(i.id);var o="NOOP";var s=[];var l;if(i.date_start)i.date_start=Number(i.date_start);if(i.date_end)i.date_end=Number(i.date_end);if(i.was_rejected)i.was_rejected=Boolean(i.was_rejected);if(i.is_dm_call)i.is_dm_call=Boolean(i.is_dm_call);if(i.was_missed)i.was_missed=Boolean(i.was_missed);if(a){TS.log(4,'updating existing room "'+i.id+'"');l=a.channels||[];_.forOwn(i,function(t,r){if(-1!==e.indexOf(r)){if(t&&!TS.utility.areSimpleObjectsEqual(t,a[r])){s.push(r);a[r]=t;o="CHANGED";if("channels"===r)l=l.concat(t||[])}}else if(a[r]!=t)if(t&&!TS.utility.isScalar(t)){a[r]=t;TS.warn(r+" is not scalar! it needs to be handled by upsertRoom specifically to test if it has changed! "+n(i[r]))}else if("boolean"!==typeof t||!t!=!a[r]){s.push(r);a[r]=t;o="CHANGED"}});i=a}else if(i.id){o="ADDED";TS.log(4,'adding room "'+i.id);r.push(i)}else TS.error("bad error, no room.id");return{status:o,room:i,what_changed:s}}});var e=["participants","channels","participant_history","participants_camera_on","participants_camera_off","participants_screenshare_on","participants_screenshare_off"]})()},4227:function(e,t){(function(){"use strict";TS.registerModule("permissions.teams",{canLeaveTeam:function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return false;if(!_.get(t,"enterprise_id"))return false;return!!(false===t.can_leave&&t.cannot_leave_reasons&&1===t.cannot_leave_reasons.length&&"not_team_member"===t.cannot_leave_reasons[0]&&!t.is_assigned)}})})()},4230:function(e,t){(function(){"use strict";TS.registerModule("pending_users",{sanitizeNameFields:function e(t){if(!t.invite_prefs||t.invite_prefs.real_name)return;var n=t.invite_prefs;if(n.first_name&&n.last_name)n.real_name=[n.first_name,n.last_name].join(" ").trim();else if(n.first_name)n.real_name=n.first_name;else if(n.last_name)n.real_name=n.last_name},getUserNameForSort:function e(t){if(t.invite_prefs&&t.invite_prefs.real_name)return t.invite_prefs.real_name.toLowerCase();return t.email},filterOutURAs:function e(t){return t.filter(function(e){if(e.invite_prefs&&"ultra_restricted"===e.invite_prefs.type)return false;return true})},checkUserMatch:function e(t,n){return t.invite_prefs&&t.invite_prefs.real_name&&t.invite_prefs.real_name.match(n)||t.email.match(n)},invitePendingUsersToChannel:function e(t,n){if(!n||!t||!t.length)return;var i=t.map(function(e){return e.email});while(i.length){var r=i.splice(0,30).join(",");TS.api.call("channels.invitePendingUsers",{channel:n,emails:r})}},usersSorterByName:function e(t,n){var i=t.member?TS.members.getMemberNameForSort(t.member):TS.pending_users.getUserNameForSort(t);var r=n.member?TS.members.getMemberNameForSort(n.member):TS.pending_users.getUserNameForSort(n);if(i<r)return-1;if(i>r)return 1;return 0}})})()},4241:function(e,t){(function(){"use strict";TS.registerModule("ms.flannel",{isFlannelMessage:function e(t){return"flannel"===t.type},call:function t(n,i,r){if(_.isUndefined(r))r=1;if(!_.isNumber(r)||r<1)throw new Error("Invalid value for attempt_number");var a={type:"flannel",subtype:n};if(_.isObject(i)){if(i.hasOwnProperty("type")||i.hasOwnProperty("subtype"))throw new Error("Arguments must not include `type` or `subtype` fields");_.merge(a,i)}if(!TS.useSocket())return Promise.reject(new Error("Flannel queries are not available on this page"));var o=TS.interop.SocketManager.hasOpenWebSocket();if(!o){TS.log(1989,"Flannel: received a "+n+" call while we are not connected; deferring");var s=arguments;return TS.interop.SocketManager.promiseToHaveOpenWebSocket().then(function(){TS.log(1989,"Flannel: connected! Continuing deferred "+n+" call");return TS.ms.flannel.call.apply(this,s)}.bind(this))}return new Promise(function(t,o){var s=function a(){if(r<e){TS.log(1989,"Flannel: retrying "+n+" call; attempt #"+r+" of "+e);return TS.ms.flannel.call(n,i,r+1).then(t).catch(o)}TS.log(1989,"Flannel: giving up on "+n+" call");o(new Error("Lost Flannel connection"))};TS.interop.SocketManager.send(a).then(function(e){Promise.delay(0).then(function(){t(e)})}).catch(function(e){if(e&&"socket_closed"===e.message){s();return}var t=new Error("Flannel call failed");t.imsg=e.msg;o(t)})})}});var e=3})()},4251:function(e,t){(function(){"use strict";TS.registerModule("utility.process_nicely",{process:function e(t,n,i,r,a,o){if(_.isUndefined(a))a=o?t.length-1:0;var s=o?-1:t.length;var l=o?-1:1;return new Promise(function(e,c){var u;var d=10;var _=performance.now();try{n();for(u=a;u!==s;u+=l){i(t[u]);var f=performance.now()-_;var m=f>d;if(m)break}}catch(e){c(e);return}finally{r()}var g=u+1<s;if(!g){e();return}setTimeout(function(){TS.utility.process_nicely.process(t,n,i,r,u+1,o).then(e).catch(c)},0)})},processRight:function e(t,n,i,r,a){var o=true;return TS.utility.process_nicely.process(t,n,i,r,a,o)}})})()},4252:function(e,t){(function(){"use strict";TS.registerModule("utility.invites",{onStart:function e(){},hideFullMemberInviteOption:function e(){var t=TS.boot_data.page_needs_enterprise;var n="saml"===TS.model.team.prefs.auth_mode;var i=0===TS.model.team.prefs.sso_auth_restrictions||1===TS.model.team.prefs.sso_auth_restrictions;if(t)return false;return t||n&&i}})})()},4253:function(e,t){(function(){"use strict";TS.registerModule("utility.ui",{onStart:function e(){},isElementVisible:function r(a,o,s){var l=window.getComputedStyle(a);if(!n(o,s).all)return false;if(!i(o))return false;if(!t(l))return false;if(!e(a))return false;return true}});var e=function e(n){while(n.parentNode&&"HTML"!==n.tagName){var i=window.getComputedStyle(n);if(t(i))n=n.parentNode;else return false}return true};var t=function e(t){return"none"!==t.display&&"hidden"!==t.visibility&&0!=t.opacity&&0!=t.maxHeight&&0!=t.maxWidth};var n=function e(t,n){n=n||0;var i=(window.innerHeight||document.documentElement.clientHeight)+n;var r=(window.innerWidth||document.documentElement.clientWidth)+n;var a=t.top>-n;var o=t.left>-n;var s=t.right<=r;var l=t.bottom<=i;var c={all:a&&s&&l&&o,top:a,right:s,bottom:l,left:o};return c};var i=function e(t){return t.height>0&&t.width>0}})()},4255:function(e,t){(function(){"use strict";TS.registerModule("selection",{isAnyTextSelected:function e(){return""!=window.getSelection().toString().trim()},selectNode:function e(t){if(!t)return;if(!document.body.contains(t)){TS.warn("TS.selection.selectNode: node is not in DOM");return}var n=document.createRange();n.selectNode(t);var i=window.getSelection();i.removeAllRanges();i.addRange(n);return i},selectNodeContents:function e(t){if(!t)return;if(!document.body.contains(t)){TS.warn("TS.selection.selectNodeContents: node is not in DOM");return}var n=document.createRange();n.selectNodeContents(t);var i=window.getSelection();i.removeAllRanges();i.addRange(n);return i},selectCharacters:function e(t,n,i){if(!t)return;if(!document.body.contains(t)){TS.warn("TS.selection.selectCharacters: node is not in DOM");return}if(!_.isNumber(n))n=0;if(!_.isNumber(i))i=n;if("setSelectionRange"in t){t.focus();t.setSelectionRange(n,i);return}if(!t.childNodes.length)return;var r=0;var a;var o=0;var s;var l=0;var c=TS.utility.getChildTextNodes(t);_.each(c,function(e){var t=e.textContent.length;if(!a&&r+t>=n){a=e;o=n-r}if(!s&&r+t>=i){s=e;l=i-r}if(a&&s)return false;r+=t});if(!a||!s){TS.warn("TS.selection.selectCharacters: could not find start and end nodes");return}var u=document.createRange();u.setStart(a,o);u.setEnd(s,l);var d=window.getSelection();d.removeAllRanges();d.addRange(u)},snapshot:function e(){var t=window.getSelection();var n;if(t.rangeCount)n=t.getRangeAt(0).cloneRange();return function(){var e=window.getSelection();e.removeAllRanges();if(n)e.addRange(n)}},toCharacterRange:function e(t){var n={start:0,end:0};if(!t)return n;if(!document.body.contains(t)){TS.warn("TS.selection.toCharacterRange: node is not in DOM");return}var i=rangy.getSelection();if(!i.rangeCount)return n;var r=i.getRangeAt(0);n=r.toCharacterRange(t);return n},insertAtCaret:function e(t){if(!_.isString(t))t="";var n=window.getSelection();if(!n.rangeCount)TS.warn("TS.selection.insertAtCaret: no range");var i=n.getRangeAt(0);i.deleteContents();var r=document.createTextNode(t);i.insertNode(r);i.setStartAfter(r);n.removeAllRanges();n.addRange(i)},removeNextChars:function e(t){if(!_.isNumber(t)||!t)return;var n=rangy.getSelection();var i=n.getRangeAt(0);if(t>0)i.moveEnd("character",t);else i.moveStart("character",t);i.deleteContents()}})})()},4259:function(e,t){(function(){"use strict";TS.registerModule("menu.enterprise_team_signin",{start:function n(i,r,a){if(TS.menu.isRedundantClick(i))return;if(TS.model.menu_is_showing)return;a=_.merge({},a);e=a.team_id;t=a.list;TS.menu.buildIfNeeded();TS.menu.enterprise_team_signin.clean();TS.menu.$menu.addClass("enterprise_team_signin_menu");TS.menu.$menu_header.addClass("hidden").empty();var o=TS.templates.enterprise_team_signin_menu_items({should_show_leave_team:a.should_show_leave_team,team_site_url:a.team_site_url||""});TS.menu.$menu_items.html(o);TS.menu.$menu_items.on("click.menu","li",TS.menu.enterprise_team_signin.onMenuItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.enterprise_team_signin.onMenuItemClick);TS.menu.start(i,false);TS.menu.$menu.attr("data-qa","enterprise_team_signin_menu");TS.menu.positionAt(r,r.width()-TS.menu.$menu.width(),r.outerHeight()+10)},onMenuItemClick:function e(t){var i=$(this).closest("[data-which]");if(!i.length)i=$(t.target).closest("[data-which]");var r=i.data("which");if("visit_team_site"===r);else if("leave_team"===r){t.preventDefault();n()}else{t.preventDefault();TS.warn("not sure what to do with clicked element:"+r)}TS.menu.enterprise_team_signin.end()},clean:function e(){TS.menu.clean()},end:function e(){TS.menu.end()}});var e;var t;var n=function n(){TS.ui.leave_team_dialog.start(e,t);var i;var r;if("teams_on"===t){i="your_workspaces";r="your_workspaces_list"}else{i="find_workspaces";r="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamLeave(e,i,r)}})()},4260:function(e,t){(function(){"use strict";TS.registerModule("ui.leave_team_dialog",{team_id:null,ladda:null,list:null,start:function t(n,r){TS.ui.leave_team_dialog.team_id=n;TS.ui.leave_team_dialog.list=r;var a=TS.enterprise.getTeamById(TS.ui.leave_team_dialog.team_id);var o={team:a};var s={title:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Leave Workspace","enterprise_workspaces")():TS.i18n.t("Leave Team","enterprise_workspaces")(),body_template_html:TS.templates.leave_workspace_dialog(o),onShow:e,onCancel:i,modal_class:"leave_team_modal"};TS.ui.fs_modal.start(s)}});var e=function e(){var i=$(".leave_team_modal .leave_team_modal_contents");i.find(".buttons").on("click","button",function(){var e=$(this).data("qa");if("cancel_leave_team"===e)TS.ui.fs_modal.close();else if("confirm_leave_team"===e){var i=Ladda.create(this);i.start();var r={team:TS.ui.leave_team_dialog.team_id};if(TS.model.enterprise_api_token)r.enterprise_token=TS.model.enterprise_api_token;TS.api.call("enterprise.teams.leave",r,function(e,i,r){var a=TS.enterprise.getTeamById(r.team);var o=emoji.replace_colons(":sparkles:");o+=TS.i18n.t(" You’ve successfully left <strong>{team_name}</strong>","enterprise_workspaces")({team_name:_.escape(a.name)});if(e){t(r.team);n("success",o);TS.ui.fs_modal.close()}else{var s;if("disable_denied_due_to_idpgroup_membership"===i.error){s=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('You can’t leave this workspace.<br>Because you’re in an IdP group assigned to this workspace, you can’t leave it here. <a href="mailto:{primary_owner_email}" target="_blank">Contact an Org Admin</a> for help leaving the workspace.',"enterprise_workspaces")({primary_owner_email:TS.model.enterprise.primary_owner.email}):TS.i18n.t('You can’t leave this team.<br>Because you’re in an IdP group assigned to this team, you can’t leave it here. <a href="mailto:{primary_owner_email}" target="_blank">Contact an Org Admin</a> for help leaving the team.',"enterprise_workspaces")({primary_owner_email:TS.model.enterprise.primary_owner.email});n("error",s)}else if("user_deleted_already"===i.error){t(r.team);n("success",o);TS.ui.fs_modal.close()}else if("failed_to_convert_org_user_to_team_user"===i.error){t(r.team);n("success",o);TS.ui.fs_modal.close()}else{s=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('Leaving workspace failed with error "{error}"',"enterprise_workspaces")({error:i.error}):TS.i18n.t('Leaving team failed with error "{error}"',"enterprise_workspaces")({error:i.error});n("error",s)}}});var a;var o;if("teams_on"===TS.ui.leave_team_dialog.list){a="your_workspaces";o="your_workspaces_list"}else{a="find_workspaces";o="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamLeaveConfirm(TS.ui.leave_team_dialog.team_id,a,o)}})};var t=function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=n.enterprise_user.teams.filter(function(e){return e!==t});if("web"===TS.boot_data.app)TS.model.user=n;else TS.members.upsertMember(n);var i=TS.enterprise.getTeamById(t);var r=$('[data-id="'+t+'"]');if(!i.is_unlisted)r.html(TS.enterprise.workspaces.getTeamCardHTML(i));else r.remove();var a=$('.workspace_info[data-team-id="'+t+'"]');if(a.length){var o=$(".workspaces").attr("data-list");a.html(TS.templates.team_info({list:o,team:i,user:TS.model.user}))}};var n=function e(t,n){TS.ui.toast.show({type:t,message:n})};var i=function e(){}})()},4264:function(e,t){(function(){"use strict";TS.registerModule("debug_widget",{onStart:function t(){if(!TS.client)return;if(!TS.client.ui)return;if(!TS.members)return;e=$("#debug_widget");if(!e.length)return;TS.client.ui.did_rebuild_all_sig.add(g);TS.client.ui.did_rebuild_all_but_msgs_sig.add(f);TS.client.msg_pane.did_rebuild_msgs_sig.add(m);TS.members.member_was_upserted_sig.add(d);e.click(function(e){e.preventDefault();if(e.altKey){i=0;r=0;a=0;o=0;n=0;h()}});if(window.localStorage&&window.localStorage.show_debug_widget)TS.debug_widget.toggle()},toggle:function n(){if(!TS.client||!e)return;e.toggleClass("hidden");if(e.hasClass("hidden")){t=false;if(window.localStorage)delete window.localStorage.show_debug_widget;e.empty()}else{t=true;if(window.localStorage)window.localStorage.show_debug_widget=1;h()}},isVisible:function e(){return!!t},setFrameRate:function e(t){s=t}});var e;var t=false;var n=0;var i=0;var r=0;var a=0;var o=0;var s=0;var l=500;var c;var u=Handlebars.compile('Rt={{rebuild_all_count}} Rb={{rebuild_all_but_messages_count}} Rm={{rebuild_messages_count}}<br>Um={{upsert_member_count}} <span class="{{color_class}}"><ts-icon class="ts_icon_add_user"></ts-icon> {{time_since_readable}}</span><br>Members={{total_member_count}} <ts-icon class="ts_icon_user"></ts-icon><br>FPS={{average_frame_rate}}');var d=function e(){o+=1;n=Date.now();v()};var f=function e(){r+=1;v()};var m=function e(){a+=1;v()};var g=function e(){i+=1;v()};var p=function e(){var t=Date.now()-n;var l="";if(t<2e3)l="candy_red";else if(t<1e4)l="star_yellow";else if(t<2e4)l="ocean_teal";var c="";if(t<1e3)c="<1s";else if(t<2e4)c=Math.floor(t/1e3)+"s";return{has_recent_member_upsert:!!l,color_class:l,rebuild_all_count:i,rebuild_all_but_messages_count:r,rebuild_messages_count:a,time_since_readable:c,upsert_member_count:o,total_member_count:_.get(TS,"model.members.length",0),average_frame_rate:s||"..."}};var h=function t(){clearTimeout(c);c=void 0;var n=p();var i=u(n);e.html(i);if(n.has_recent_member_upsert)v()};var v=function n(){if(!e)return;if(!t)return;if(c)return;c=setTimeout(h,l)}})()},4267:function(e,t){(function(){"use strict";TS.registerModule("mentions",{mention_changed_sig:new signals.Signal,mention_removed_sig:new signals.Signal,mentions_fetched_sig:new signals.Signal,mentions_being_fetched_sig:new signals.Signal,mentions_being_fetched:false,mentions_needs_fetched:false,has_more:false,after_ts:null,fetched_once:false,active_tab:"all",test:function e(){var e={};return e},onStart:function e(){TS.prefs.mentions_exclude_at_channels_changed_sig.add(n);TS.prefs.mentions_exclude_at_user_groups_changed_sig.add(i)},maybeUpdateMentions:function e(t){if("client"!==TS.boot_data.app)return;if(!TS.model.team)return;if(TS.mentions.mentions_being_fetched||!TS.mentions.fetched_once||"mentions"!==TS.model.ui_state.flex_name){TS.mentions.mentions_needs_fetched=true;return}TS.mentions.updateMentions(t)},updateMentions:function t(n){TS.mentions.mentions_being_fetched=true;TS.mentions.mentions_needs_fetched=false;TS.mentions.mentions_being_fetched_sig.dispatch(n);var i=true;TS.api.call("activity.mentions",e(),TS.mentions.onFetchMentions,i)},fetchMoreMentions:function e(){TS.mentions.fetchMentions(TS.mentions.after_ts)},fetchMentions:function t(n){TS.mentions.mentions_needs_fetched=false;TS.mentions.fetched_once=true;var i=e();n=n||"";i.after_ts=n;TS.api.call("activity.mentions",i,TS.mentions.onFetchMentions)},getMentionByMsgId:function e(t,n,i){var r;var a;var o;function s(e,t){return _.find(e,function(n,i){if(n.message&&n.message.ts===t){a=e;o=i;return true}return false})}r=s(TS.model.user.mentions,t);if(!r)return null;if(n&&r.message)r.message=n;else if(i&&_.isArray(a)&&_.isNumber(o))a.splice(o,1);return r},onFetchMentions:function e(t,n){TS.mentions.mentions_being_fetched=false;if(TS.mentions.mentions_needs_fetched)setTimeout(TS.mentions.maybeUpdateMentions,100);if(!t){TS.error("failed fetchMentions");return}var i;var r=[];var a;for(var o=0;o<n.mentions.length;o+=1){i=n.mentions[o];if("reaction"===i.type)if("message"===i.item.type){i.rxn_ts=i.ts;i.channel=i.item.channel;i.message=i.item.message;i.item.message._rxn_key=TS.rxns.getRxnKey("message",i.item.message.ts,i.item.channel);delete i.item}else if("file"===i.item.type){i.rxn_ts=i.ts;i.channel=_.first(i.item.file.channels);i.message={file:i.item.file,subtype:"file_reaction",ts:i.ts};delete i.item}else continue;var s=i.message;if(!s)continue;var l=s.file;var c=s.comment;if("file_share"===s.subtype||"file_mention"===s.subtype||"file_comment"===s.subtype||"file_reaction"===s.subtype){if(!l)continue;if("file_comment"===s.subtype)if(!c)continue}if("0000000000.000000"==s.ts){TS.warn("bad mention! msg.ts == 0000000000.000000");continue}if("file_share"===s.subtype||"file_mention"===s.subtype||"file_comment"===s.subtype||"file_reaction"===s.subtype){l._rxn_key=TS.rxns.getRxnKey("file",l.id);a=TS.rxns.getExistingRxnsByKey(l._rxn_key);if(a&&!l.reactions)TS.warn("file:"+l.id+" has reactions in local model, but we got an object in mentions that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(l._rxn_key,l.reactions);if("file_comment"===s.subtype){c._rxn_key=TS.rxns.getRxnKey("file_comment",c.id);a=TS.rxns.getExistingRxnsByKey(c._rxn_key);if(a&&!c.reactions)TS.warn("comment:"+c.id+" has reactions in local model, but we got an object in mentions that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(c._rxn_key,c.reactions)}}else{s._rxn_key=TS.rxns.getRxnKey("message",s.ts,i.channel);a=TS.rxns.getExistingRxnsByKey(s._rxn_key);if(a&&!s.reactions)TS.warn("msg:"+s.ts+" has reactions in local model, but we got an object in mentions that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(s._rxn_key,s.reactions);var u=TS.shared.getModelObById(i.channel);var d=u&&TS.utility.msgs.getMsg(s.ts,u.msgs);if(d)s.is_starred=d.is_starred}if(TS.mentions.getMentionByMsgId(s.ts,s))continue;r.push(i)}TS.model.user.mentions=TS.model.user.mentions.concat(r);TS.mentions.sortMentions();TS.mentions.has_more=n.has_more;if(TS.model.user.mentions.length){i=TS.model.user.mentions[TS.model.user.mentions.length-1];TS.mentions.after_ts="reaction"===i.type?i.rxn_ts:i.message.ts}TS.mentions.mentions_fetched_sig.dispatch()},sortMentions:function e(){var t;var n;function i(e,i){t=e.rxn_ts||e.message.ts;n=i.rxn_ts||i.message.ts;if(t<n)return 1;if(t>n)return-1;return 0}TS.model.user.mentions.sort(i)},replaceMsg:function e(t){var n=TS.mentions.getMentionByMsgId(t.ts,t);if(n)TS.mentions.mention_changed_sig.dispatch(n)},removeMsg:function e(t){var n=TS.mentions.getMentionByMsgId(t,null,true);if(n)TS.mentions.mention_removed_sig.dispatch(t)},setExcludeAtChannelsPref:function e(t){t=!!t;TS.model.prefs.mentions_exclude_at_channels=t;TS.prefs.setPrefByAPI({name:"mentions_exclude_at_channels",value:t});n()},setExcludeAtUserGroupsPref:function e(t){t=!!t;TS.model.prefs.mentions_exclude_at_user_groups=t;TS.prefs.setPrefByAPI({name:"mentions_exclude_at_user_groups",value:t});i()},weaveInRxnRecords:function e(){var t=TS.rxns.getRxnRecords();var n;var i;var r;var a;var o;TS.model.user.mentions=TS.model.user.mentions.filter(function(e){return"rxn"!==e.type});for(var s=0;s<t.length;s+=1){i=t[s].rxn_key;n=TS.rxns.getRxnKeyParts(i);if("message"===n.type){a=TS.shared.getModelObById(n.c_id);o=a&&TS.utility.msgs.getMsg(n.id,a.msgs);if(!o)continue;TS.mentions.getMentionByMsgId(n.id,null,true);r={channel:n.c_id,type:"reaction",rxn_ts:t[s].last_update,message:_.cloneDeep(o)};r.message._rxn_key=i}else if("file"===n.type)continue;else if("file_comment"===n.type)continue;else continue;TS.model.user.mentions.push(r)}TS.mentions.sortMentions()}});var e=function e(){return t()};var t=function e(){var t={count:20,reactions:1};var n=["thread"];if(TS.model.prefs.mentions_exclude_at_channels){n.push("everyone");n.push("channel")}if(TS.model.prefs.mentions_exclude_at_user_groups)n.push("user_group");if(n.length>0)t.exclude=n.join(",");return t};var n=function e(){var t=TS.model.prefs.mentions_exclude_at_channels;if(t){r(["everyone","channel"]);TS.mentions.mentions_fetched_sig.dispatch()}else TS.mentions.maybeUpdateMentions()};var i=function e(){var t=TS.model.prefs.mentions_exclude_at_user_groups;if(t){r(["user_group"]);TS.mentions.mentions_fetched_sig.dispatch()}else TS.mentions.maybeUpdateMentions()};var r=function e(t){var n;for(var i=TS.model.user.mentions.length-1;i>=0;i-=1){n=TS.model.user.mentions[i];if(-1!==t.indexOf(n.type))TS.model.user.mentions.splice(i,1)}}})()},4268:function(e,t){(function(){"use strict";TS.registerModule("inline_videos",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){$("#messages_container").on("keydown",".msg_inline_media_toggler",function(){if(13==event.which||32==event.which)event.target.click()})},shouldExpand:function e(t,n){if(TS.model.expandable_state["vid_"+t+n.src])return true;if(false===TS.model.expandable_state["vid_"+t+n.src])return false;if(n.internal_file_id)return TS.model.prefs.expand_internal_inline_imgs;return TS.model.prefs.expand_inline_imgs},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=video]:not(.expanded)");if(!t.length)return;TS.inline_videos.no_scrolling=true;t.trigger("click");TS.inline_videos.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=video].expanded").trigger("click")},expand:function e(t,n){TS.model.expandable_state["vid_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(t);var r=$(i);if(!r.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=function e(){return $(this).data("real-src")==n};var s=TS.boot_data.feature_attachments_inline?r.find(".inline_attachment").filter(o):null;if(!s||!s.length)s=r.find(".msg_inline_video_holder").filter(o);s.find(".msg_inline_video_thumb_div").removeClass("hidden");s.removeClass("hidden");r.find(".msg_inline_media_toggler[data-media-type=video]:not(.expanded)").filter(o).attr("aria-expanded","true");r.find(".msg_inline_media_toggler[data-media-type=video]:not(.expanded)").filter(o).addClass("expanded");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();s.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_videos.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);r.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else r.find(".msg_inline_video").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_videos.expand_sig.dispatch(t);if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,n){TS.model.expandable_state["vid_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(t);var r=$(i);if(!r.length)return;var a=function e(){return $(this).data("real-src")==n};var o=TS.boot_data.feature_attachments_inline?r.find(".inline_attachment").filter(a):null;if(!o||!o.length)o=r.find(".msg_inline_video_holder").filter(a);o.css("visibility","hidden");r.find(".msg_inline_media_toggler[data-media-type=video].expanded").filter(a).attr("aria-expanded","false");r.find(".msg_inline_media_toggler[data-media-type=video].expanded").filter(a).removeClass("expanded");o.find(".msg_inline_video_iframe_div").html("");TS.inline_videos.collapse_sig.dispatch(t);setTimeout(function(){o.addClass("hidden");o.css("visibility","visible")},200)},enCommentHTML:function e(t){if(!t)return"";var n=new DOMParser;var i="<body>"+t+"</body>";var r=n.parseFromString(i,"text/html")||n.parseFromString(i,"text/xml");if(!r||!r.body)return"";if(0===r.body.childNodes.length)return"";if(1==r.body.childNodes.length&&r.body.childNodes[0].nodeType==Node.COMMENT_NODE)return r.body.innerHTML;var a=document.createComment(t);return $("<div>").append(a).html()},unCommentHTML:function e(t){if(!t)return"";var n=new DOMParser;var i=n.parseFromString("<body>"+t+"</body>","text/html");if(!i||!i.body)return"";if(1!=i.body.childNodes.length)return"";var r=i.body.childNodes[0];if(r.nodeType!=Node.COMMENT_NODE)return"";return r.textContent},checkForInlineVideoClick:function e(t){if(!t.target)return;var n=$(t.target);var i;var r=n.closest(".message");i=r.attr("id");if(!i)return;var a=n.closest(".msg_inline_media_toggler[data-media-type=video]");if(a.length){t.preventDefault();var o=a.data("real-src");if(a.hasClass("expanded"))TS.inline_videos.collapse(i,o);else TS.inline_videos.expand(i,o);return}var s=n.closest(".msg_inline_video_play_button");if(s.length){var l=s.closest(".msg_inline_video_holder");var c=l.find(".msg_inline_video_iframe_div");c.removeClass("hidden");l.find(".msg_inline_video_thumb_div").addClass("hidden");var u=c.data("url");var d=TS.model.inline_videos[u];if(!d){var f=u.replace(/&/g,"&amp;");d=TS.model.inline_videos[f]}if(d){c.html(TS.inline_videos.unCommentHTML(d.html));if(u.indexOf(true)){var m=c.find("video");if(m.length)m[0].play()}}else{var g=TS.i18n.t('<div style="padding:10px; color:white">Error: unable to find "{url}" in TS.model.inline_videos</div>',"inline_videos")({url:_.escape(u)});c.html(g)}}},makeInternalInlineVideo:function e(n,i){var r=400;var a=500;TS.model.inline_videos[n]=i;i.src=i.thumbnail.url||n;i.display_w=parseInt(i.thumbnail.width,10);i.width=i.display_w;i.display_h=parseInt(i.thumbnail.height,10);i.height=i.display_h;if(i.display_w>r){i.display_w=r;i.display_h=parseInt(i.height*(i.display_w/i.width),10)}if(i.display_h>a){i.display_h=a;i.display_w=parseInt(i.width*(i.display_h/i.height),10)}if(!i.html)i.html="MISSING video.html";if(i.html.indexOf("gfycat.com/ifr")>-1)i.html=t(i.html);i.html=i.html.replace("http://","//");if(-1==i.html.indexOf("oldwidth")){i.html=i.html.replace(" width=",' width="'+i.display_w+'" oldwidth=');i.html=i.html.replace(" height=",' height="'+i.display_h+'" oldheight=')}i.html=TS.inline_videos.enCommentHTML(i.html);i.html=TS.utility.swapInRedirUrlForIframe(i.html);var o=TS.utility.getImgProxyURL(i.src,i.display_w,i.display_h);if(o!=i.src)i.proxied_src=o;else delete i.proxied_src},test:function e(){return{maybeRewriteGfyCatHtml:t}}});var e=/^[a-zA-Z0-9]+$/;var t=function t(n){var i=TS.utility.getAttributesFromHTMLString(n);var r=i.src;if(!r)return n;var a=r.split("ifr/")[1]||"";if(!a.match(e))return n;var o=parseInt(i.width,10);var s=parseInt(i.height,10);if(!o||!s)return n;i.src="https://"+document.location.host+"/gfycat_iframe.php?key="+a+"&w="+o+"&h="+s+"&"+Date.now();var l=$("<iframe>").attr(i);return l[0].outerHTML}})()},4276:function(e,t){(function(){"use strict";TS.registerModule("validation",{onStart:function e(){},firstalphanumeric:n,isurl:i,lowercase:r,maxlength:a,minlength:o,nospace:s,required:l,reservedwords:c,keywords:u,username:d,username_with_errors:_,team_name:f,team_name_with_errors:m,is_email:p,pattern:g});var e=/^(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;var t={empty:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Please fill in your workspace name.","ui_validation")():TS.i18n.t("Please fill in your team name.","ui_validation")(),too_long:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Sorry, your workspace name must be 255 characters or fewer!","ui_validation")():TS.i18n.t("Sorry, your team name must be 255 characters or fewer!","ui_validation")()};function n(e){return/^[^\W_]/.test(e)}function i(t){if(!t)return true;var n=t.match(e);if(n&&1===n.length&&n[0]===t)return true;return false}function r(e){return e===e.toLocaleLowerCase()}function a(e,t){return e.length<=t}function o(e,t){return e.length>=t}function s(e){return!/\s/.test(e)}function l(e){return e.trim().length>0}function c(e,t){var n=e.trim().toLowerCase();return-1===t.indexOf(n)}function u(e){var t=e.trim().toLowerCase();return-1===TS.model.RESERVED_KEYWORDS.indexOf(t)}function d(e){return l(e)&&a(e,21)&&s(e)&&g(e,/^[\w._-]+$/)&&n(e)&&r(e)&&c(e,TS.model.RESERVED_USERNAMES)}function _(e){if(!l(e))return"empty";if(!a(e,21))return"too_long";if(!s(e))return"contains_spaces";if(!g(e,/^[\w._-]+$/))return"contains_special_characters";if(!n(e))return"bad_first_character";if(!r(e))return"contains_uppercase";if(!c(e,TS.model.RESERVED_USERNAMES))return"contains_reserved_words";return true}function f(e){return l(e)&&a(e,255)}function m(e){if(!l(e))return{error_key:"empty",error_message:t.empty};if(!a(e,21))return{error_key:"too_long",error_message:t.too_long};return true}function g(e,t){return t.test(e)}function p(e){var t=e.match(TS.utility.email.EMAIL_REGEX);return t&&1===t.length&&t[0]===e||false}})()},4277:function(e,t){(function(){"use strict";TS.registerModule("ui.token_input",{onStart:function e(){},make:function e(t,r){if(!(t&&t.length))return;var a=t.find("input");if(!(a&&a.length))return;if(a.val().trim())n(a);t.on("click",function(){t.addClass("active");a.focus()});a.on("paste",function(){setTimeout(function(){var e=a.val().trim();if(!/,/.test(e))return true;if(e)n(a,r)},0)}).on("keydown",function(e){var t=a.val().length;if(!t&&e.which===TS.utility.keymap.del)i(a,r);else if(1===t&&!a.prev(".token").length)i(a,r);if(t&&e.which===TS.utility.keymap.enter)n(a,r)}).on("keyup",function(e){var t=a.val().length;if(t&&(e.which===TS.utility.keymap.comma||e.which===TS.utility.keymap.space))n(a,r)}).on("focusout",function(){n(a,r);t.removeClass("active")}).on("focusin",function(){t.addClass("active")});a.data("placeholder",a.attr("placeholder"));if(t.find(".token").length)a.attr("placeholder","");if(r&&r.remove_on_click)t.on("click",".token",function(){$(this).remove()})},value:function n(i,r){if(r)return t(i,r);return e(i)}});var e=function e(t){var n=[];t.find(".token").each(function(){var e=$(this).text().trim();n.push(e)});return n.join(", ")};var t=function e(t,i){var r=t.find("input");t.find(".token").remove();r.val(i);n(r)};var n=function e(t,n){var i=t.val().trim();var r=i.split(/\s*[,\s]\s*/);var a=false;r.forEach(function(e){if(e){var i=$("<span />").addClass("token").text(e);i.toggleClass("remove_on_click",n&&n.remove_on_click);t.before(i);a=true;if(n&&n.onTokenChange)n.onTokenChange(t,i)}});if(a)t.attr("placeholder","").val("")};var i=function e(t,n){var i=t.prev(".token");if(i.length){var r=i.text();i.remove();t.val(r+" ")}else t.attr("placeholder",t.data("placeholder"));if(n&&n.onTokenChange)n.onTokenChange(t)}})()},4279:function(e,t){(function(){"use strict";TS.registerModule("ui.workspaces",{start:function i(){if(!TS.boot_data.page_needs_enterprise)return;if(TS.model.user.is_restricted)return;return TS.enterprise.promiseToGetTeams().then(function(){var i="teams_not_on";var r="members";var a="";var o=TS.enterprise.workspaces.getList(i,r,a,e);var s=TS.boot_data.logout_url;o=o.map(function(e){var t=TS.enterprise.workspaces.createURL(e,s);e.launch_url=t+"messages";e.site_url=t+"home";e.signout_url=TS.enterprise.workspaces.createLogoutURL(e.id,s);return e});var l={teams:o,user:TS.model.user};if(TS.boot_data.feature_workspace_request)l.org_prefs_ws_request_admin_enabled=_.get(TS.boot_data,"enterprise_prefs.org_prefs.enterprise_team_creation_request.is_enabled")&&!TS.model.user.is_restricted;var c={title:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Join {enterprise_name} Workspaces","enterprise_workspaces")({enterprise_name:TS.model.enterprise.name}):TS.i18n.t("Join {enterprise_name} Teams","enterprise_workspaces")({enterprise_name:TS.model.enterprise.name}),body_template_html:TS.templates.workspaces_dialog(l),onShow:t,onCancel:n,modal_class:"fs_modal_header workspaces_modal"};TS.ui.fs_modal.start(c)})}});var e=true;var t=function e(){i()};var n=function e(){};var i=function t(){var n=$(".workspaces_modal");var i=n.find(".workspaces");var r=n.find(".workspace_info");var a=n.find(".title_bar");var o=n.find(".sort_by_container select");var s=n.find('[data-qa="teams_search"]');var l=TS.boot_data.logout_url;n.off();s.off();o.off();r.off();var c=function e(t){return TS.enterprise.workspaces.joinTeam(t).then(function(e){if(e){var i=_.merge({},TS.model.user);i.enterprise_user.teams=_.uniq(i.enterprise_user.teams.concat(t));TS.members.upsertMember(i);var r=TS.enterprise.getTeamById(t);n.find('[data-id="'+t+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(r,l));var a="workspace_detail";var o="find_workspaces";TS.enterprise.workspaces.recordTeamJoin(r.id,o,a)}return e})};s.on("input",function(){var n=$(this).val();var r=o.val();var a="teams_not_on";var s=TS.enterprise.workspaces.getList(a,r,n,e);var c="";if(s.length)s.forEach(function(e){c+=TS.enterprise.workspaces.getTeamCardHTML(e,l,true)});else c+=TS.templates.no_workspace_results();i.html(c);t()});o.on("change",function(){var n=$(this).val();var r=s.val();var a="teams_not_on";var o=TS.enterprise.workspaces.getList(a,n,r,e);var c="";o.forEach(function(e){c+=TS.enterprise.workspaces.getTeamCardHTML(e,l,true)});i.html(c);t()});n.on("click",".enterprise_team_card",function(){var e=$(this).data("id");i.addClass("hidden");a.addClass("hidden");s.addClass("hidden").attr("disabled","disabled");r.html(TS.templates.team_info({list:"teams_not_on"})).removeClass("hidden");var t={top_combined_channels:5,include_admins:true};return TS.enterprise.ensureTeamInModel(e,t).then(function(e){if(!e)return;var t=TS.enterprise.workspaces.createURL(e,l);e.launch_url=t+"messages";e.site_url=t+"home";r.html(TS.templates.team_info({list:"teams_not_on",team:e,user:TS.model.user}));var n="find_workspaces";var i="workspaces_you_can_join_list";TS.enterprise.workspaces.recordTeamView(e.id,n,i)})});r.on("click",".back_to_teams",function(e){e.preventDefault();i.removeClass("hidden");a.removeClass("hidden");s.removeClass("hidden").removeAttr("disabled");r.addClass("hidden")});r.on("click",'button[data-qa="join-btn"]',function(){var e=Ladda.create(this);e.start();var t=$(this).data("id");var n=TS.enterprise.getTeamById(t);c(t).then(function(t){e.stop();if(t){var i=TS.enterprise.workspaces.createURL(n,l);n.launch_url=i+"messages";n.site_url=i+"home";r.html(TS.templates.team_info({list:"teams_not_on",team:n,user:TS.model.user}));var a="find_workspaces";var o="workspace_detail";TS.enterprise.workspaces.recordTeamJoin(n.id,a,o)}return t})});r.on("click",'[data-qa="leave-btn"]',function(e){e.preventDefault();var t=$(this).data("id");TS.ui.leave_team_dialog.start(t)});r.on("click",'button[data-qa="request-to-join-btn"]',function(e){e.preventDefault();var t=Ladda.create(this);t.start();var i=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(i).then(function(){var e=TS.enterprise.getTeamById(i);n.find('[data-id="'+i+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,l));t.stop();var a=TS.enterprise.workspaces.createURL(e,l);e.launch_url=a+"messages";e.site_url=a+"home";r.html(TS.templates.team_info({list:"teams_not_on",team:e,user:TS.model.user}));var o="find_workspaces";var s="workspace_detail";TS.enterprise.workspaces.recordTeamRequestToJoin(e.id,o,s)}).catch(function(){t.stop()})});n.on("click",".enterprise_team_menu",function(e){e.stopPropagation();var t=$(this).val();var n=$(this).data("id");TS.menu.enterprise_team_signin.start(e,$(this),{list:"teams_not_on",team_id:n,team_site_url:t,should_show_leave_team:false})});n.on("click",".enterprise_team_join",function(e){e.stopPropagation();var t=Ladda.create(this);t.start();var n=$(this).data("id");c(n).then(t.stop)});n.on("click",".enterprise_team_request",function(e){e.stopPropagation();var t=Ladda.create(this);t.start();var i=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(i).then(function(){var e=TS.enterprise.getTeamById(i);t.stop();n.find('[data-id="'+i+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,l));var r="find_workspaces";var a="workspaces_you_can_join_list";TS.enterprise.workspaces.recordTeamJoin(i,r,a)}).catch(function(){t.stop()})});var u=function e(t){t.stopPropagation();if(TS.model.is_our_app){t.preventDefault();var n=$(this).data("id");var i=TS.enterprise.getTeamById(n);var r={name:TS.model.user.name,id:TS.model.user.id,team_id:n,team_name:i.name,team_url:TS.utility.enterprise.buildTeamUrl(i.domain)};var a=true;TSSSB.call("didSignIn",[r],a)}};n.on("click",".enterprise_team_card [data-name=launch_team_button]",u);r.on("click","[data-name=launch_team_button]",u);n.on("click",'[data-qa="ws-request-new-team"]',function(e){e.stopPropagation();var t;if(TS.boot_data.feature_workspace_request)t=_.get(TS.boot_data,"enterprise_prefs.org_prefs.enterprise_team_creation_request.is_enabled")&&!TS.model.user.is_restricted;if(t)TS.enterprise.workspaces.showRequestDialog()})}})()},4283:function(e,t){(function(){"use strict";TS.registerModule("ui.toggle",{onStart:function e(){$('input[type="checkbox"][data-style="toggle"]').each(function(){$(this).togglify()})},togglify:function n(i,r){if(r)r=_.defaults({},r,e);else{r={};r.initial_state=i.data("initial_state")?i.data("initial_state"):e.initial_state;r.label=i.data("label")?i.data("label"):e.label;r.on_class=i.data("on-class")?i.data("on-class"):e.on_class;r.on_text=i.data("on-text")?i.data("on-text"):e.on_text;r.off_text=i.data("off-text")?i.data("off-text"):e.off_text;r.off_class=i.data("off-class")?i.data("off-class"):e.off_class;r.off_label=i.data("off-label")?i.data("off-label"):e.off_label;r.disabled=i.data("disabled")?i.data("disabled"):e.disabled;r.cls=i.data("cls")?i.data("cls"):e.cls}if(null===r.initial_state)r.initial_state=!!i.is(":checked");if(null===r.disabled)r.disabled=!!i.is(":disabled");t(i,r);return i}});var e={cls:"",initial_state:null,label:"",on_text:TS.i18n.t("On","toggle")(),on_class:"",off_text:TS.i18n.t("Off","toggle")(),off_class:"",off_label:"",disabled:null};var t=function t(i,r){var a=i;var o=i.closest("label");if(o.length){a=o;var s=$.trim(o.text());if(s&&r.label===e.label&&r.off_label===e.off_label)r.label=s}var l=n(r);var c=$(l);a.addClass("hidden").after(c);c.on("click",function(){$(this).toggleClass("checked");i.prop("checked",$(this).hasClass("checked")).trigger("change");if(r.on_class!==r.off_class){$(this).toggleClass(r.on_class,$(this).hasClass("checked"));$(this).toggleClass(r.off_class,!$(this).hasClass("checked"))}else if(""!==r.on_class)TS.warn("TS.ui.toggle: on & off classes are the same. You may want to use the `cls` option instead")})};var n=function e(t){var n=TS.templates.toggle({settings:t});return n}})();$.fn.togglify=function(e){"use strict";return TS.ui.toggle.togglify($(this),e)}},4287:function(e,t){(function(){"use strict";TS.registerModule("ui.toast",{show:function t(n){p();var i=$.extend({},e,n);if(["success","warning","error"].indexOf(i.type)<0)i.type=e.type;if(["top","bottom"].indexOf(i.position)<0)i.position=e.position;i.message=new Handlebars.SafeString(i.message);i.retry_message=new Handlebars.SafeString(i.retry_message);if(n.retry_action)i._retryable=true;v(i);return i}});var e={dismissable:false,message:TS.i18n.t("Success","toast")(),position:"bottom",retry_action:_.noop,retry_message:TS.i18n.t("Something went wrong. Try again?","toast")(),type:"success",_retryable:false};var t=".dismiss_toast";var n=".retry_toast";var i=[];var r=false;var a;var o;var s=3e3;var l;var c=function e(){a.on("click",t,u);a.on("click",n,T)};var u=function e(){if(o)clearTimeout(o);m()};var d=function e(){if(S())h()};var f=function e(){return i.shift()};var m=function e(){if(S())h();else{a.removeClass("toast_in").addClass("toast_out");r=false;d()}};var g=function e(){if(o)clearTimeout(o);o=setTimeout(function(){m()},s)};var p=function e(){if(!a){a=$('<div id="toast" class="hidden">');var t=TS.templates.toast({});a.html(t);a.appendTo("body");c()}};var h=function e(){var t=f();if(t)v(t,true)};var v=function e(t,n){if(r&&!n)i.push(t);else{l=t;var o=TS.templates.toast({instance:t,already_exists:!!n});a.html(o);y()}};var S=function e(){return i.length>0};var T=function e(){if(!l._retryable||"error"!==l.type)return;l.retry_action();u()};var y=function e(){if(!r){a.removeClass("hidden").removeClass("toast_out").addClass("toast_in");r=true}g()}})()},4290:function(e,t){(function(){"use strict";TS.registerModule("ui.utility",{onStart:_.noop,preventElementFromScrolling:function e(t,i,r){t=$(t);if(!t.length||n){i();return}var a=t.offset();try{n=true;i()}finally{n=false}if(_.isFunction(r)){t=r();if(!t.length)return}var o=t.offset().top;var s=o-a.top;var l=t.closest(".monkey_scroller");if(!l.length)l=t.closest(":scrollable(vertical)");if(l.is("html"))l=$("body");if(0!==s){var c=l.scrollTop()+s;l.scrollTop(Math.round(c))}if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(t)},updateClosestMonkeyScroller:function e(t,n){if(!t)return;var i=t.closest(".monkey_scroller");var r=i.data("monkeyScroll");if(!r)return;if(!i.data("monkeyScrollBeingCalled")){i.data("monkeyScrollBeingCalled",true);TS.utility.setImmediate(function(){r.updateFunc(n);i.data("monkeyScrollBeingCalled",false)})}},mkFocusStyleListener:function e(t,n,i){var r="."+t;var a="."+n;var o=n+"--"+(i||"focus");var s="."+o;return function(e){var t=$(r);if(t.hasClass("hidden"))return;var n=e.target;var i=t.find(s);var l=i.get(0);if(l&&!t.get(0).contains(n)){i.removeClass(o);return}if(l&&l.contains(n)||$(n).hasClass(o))return;i.removeClass(o);$(n).closest(a).addClass(o)}},nextWithClass:function e(t,n){var i=t.next();return i.hasClass(n)||!i.length?i:TS.ui.utility.nextWithClass(i,n)},prevWithClass:function e(t,n){var i=t.prev();return i.hasClass(n)||!i.length?i:TS.ui.utility.prevWithClass(i,n)},inTabFlow:function e(t){var n=t.nodeName.toLowerCase();var r=t.getAttribute("tabindex");var a=null==r||t.tabIndex>=0;var o=null!==r&&r>=0;var s=a||o;var l=i.test(n);var c="a"===n;if(l&&!t.disabled&&"hidden"!==t.type&&s)return true;if(c&&(t.href&&s||!t.href&&o))return true;if(!(l||c)&&o)return true;return false},isVisible:function e(t){var n=$(t);return!!n.outerHeight()&&!!n.outerWidth()&&"visible"===n.css("visibility")&&"none"!==n.css("display")&&"1"===n.css("opacity")},findNodeInRegion:function e(t,n,i,r,a){var o=5;var s=o;var l=(i-a)/(n-r/o)+o;var c=function e(n,i){var a=document.elementFromPoint(n,i);var o=$(a).closest(t);if(o.length)return o;if(n<=r)return;var c=n-s;var u=i-l;return e(c,u)};return c(n,i)},isTextInput:function t(n){return n.is(e)}});var e=["input:not([type])","input[type=text]","input[type=search]","input[type=url]","input[type=tel]","input[type=email]","input[type=password]","input[type=number]","input[type=date]","input[type=month]","input[type=week]","input[type=time]","input[type=datetime]","input[type=datetime-local]","textarea","[role=textbox]"].join(",");var t=function e(t){var n=function e(t,n,i){if(n)return n;return TS.ui.utility.inTabFlow(i)&&TS.ui.utility.isVisible(i)&&t(i)?i:null};var i=function e(){return true};return function(e,a){var o=a||i;var s=n.bind(n,o);var l=$(e).find(r).toArray();return l[t](s,null)}};TS.ui.utility.firstFocusableChild=t("reduce");TS.ui.utility.lastFocusableChild=t("reduceRight");var n=false;var i=/^(input|select|textarea|button)$/;var r="input,select,textarea,button,a,div[tabindex],span[tabindex]"})()},4292:function(e,t){(function(){"use strict";TS.registerModule("ui.inline_saver",{show:function t(n){n=n||{};var r=$(n.target);if(!r.length){TS.warn("TS.ui.inline_saver called without a valid target.");return}var a=r.data("inline-saver");if(a&&a.length){a.remove();clearTimeout(r.data("inline-saver-spin-timeout"))}var o=$(TS.templates.inline_saver({custom_text:n.custom_text,hide_text:n.hide_text}));o.insertAfter(r);r.data("inline-saver",o);if(n.promise)n.promise.then(function(){i(n)}).catch(function(){i(n,true)});else{var s=setTimeout(function(){i(n)},e);r.data("inline-saver-spin-timeout",s)}}});var e=500;var t=2e3;var n=3e3;var i=function e(i,r){i=i||{};var a=$(i.target);clearTimeout(a.data("inline-saver-hide-timeout"));var o=a.data("inline-saver");if(!o||!o.length)return;var s=r?"failed":"saved";o.removeClass("saving").addClass(s);var l=r?n:t;var c=setTimeout(function(){o.remove()},l);a.data("inline-saver-hide-timeout",c)}})()},4295:function(e,t){(function(){"use strict";TS.registerModule("frecency",{onStart:function e(){},construct:function e(t,n){return s(t,n)},getExisting:function e(t){return o(t)},test:function e(){return{_clearInstance:function e(t){delete l[t]}}}});var e=864e5;var t=[144e5,e,3*e,7*e,30*e,90*e];var n=[100,80,60,40,20,10];var i=.5;var r=t[t.length-1];var a=100;function o(e){return l[e]}function s(e,o){if(l[e]){TS.error('namespace "'+e+'" already exists');return null}var s;s=TS.storage.fetchFrecency(e)||{};if(o&&o.onStart)s=o.onStart(e);function c(e,t,n,i){var r=_.keys(s);if(!n)n=function e(){return 0};var a={};_.each(r,function(e){if(e.indexOf(t)>-1||t.indexOf(e)>-1)if(Array.isArray(s[e]))_.each(s[e],function(e){if(a[e.id]){var t=h(a[e.id]);var n=h(e);if(n>t)a[e.id]=e}else a[e.id]=e});else if(a[s[e].id]){var n=h(a[s[e].id]);var i=h(s[e]);if(i>n)a[s[e].id]=s[e]}else a[s[e].id]=s[e]});var o=[];_.each(e,function(e,t){var r=0;if(s[e.id])r=h(s[e.id]);if(!i||!i.normalize)r+=n(e,i);o.push({id:e.id,score:h(a[e.id])+r,original_index:t})});if(i&&i.normalize){o=d(o);o=_.map(o,function(t,r){t.score+=n(e[r],i);return t})}o.sort(function(e,t){if(e.score===t.score)return e.original_index-t.original_index;return t.score-e.score});return o}function u(t,n){if(s[n]&&!Array.isArray(s[n]))if(s[n].id===t.id)f(s[n]);else s[n]=[s[n],m(t.id)];else if(Array.isArray(s[n])){var i=false;for(var r=0;r<s[n].length;r+=1)if(s[n][r].id===t.id){f(s[n][r]);i=true;break}if(!i)s[n].push(m(t.id))}else s[n]={id:t.id,count:1,visits:[Date.now()]};if(s[t.id]){f(s[t.id]);s[t.id]._reduced=true}else{s[t.id]=m(t.id);s[t.id]._reduced=true}if(o&&o.recordFunc)o.recordFunc(s);else TS.storage.storeFrecency(e,s)}function d(e){var t=_.get(_.maxBy(e,"score"),"score")||0;return _.map(e,function(e){if(e.score>0)e.score=e.score/t*100;return e})}function f(e){e.count+=1;if(10===e.visits.length)e.visits.shift();e.visits.push(Date.now())}function m(e){return{id:e,count:1,visits:[Date.now()]}}function g(e,t){var n={};var i=[];k(false,function(e){if(!n[e.id])n[e.id]={id:e.id,score:h(e)+s[e.id]?h(s[e.id]):0};else n[e.id].score+=h(e)});i=_.toArray(n);i.sort(function(e,t){return t.score-e.score});if(e)i=i.slice(0,e);if(t)i=d(i);return i}function p(e,t,n){var i={};var r=[];k(false,function(t){if(_.get(t,"id[0]")!==e)return;if(!i[t.id])i[t.id]={id:t.id,score:h(t)+s[t.id]?h(s[t.id]):0};else i[t.id].score+=h(t)});r=_.toArray(i);r.sort(function(e,t){return t.score-e.score});if(t)r=r.slice(0,t);if(n)r=d(r);return r}function h(e){if(!e||!e.visits)return 0;var t=0;var n=e.visits.length-1;var r=Date.now();for(n;n>=0;n-=1)t+=v(r-e.visits[n]);if(e._reduced)t*=i;return e.count*t/e.visits.length}function v(e){var i=0;var r=t.length;for(i;i<r;i+=1)if(e<t[i])return n[i];return 0}function S(e){if(e)return s[e];return s}function T(e){s=e}function y(){s={};TS.storage.clearFrecency(e);if(o&&o.onClearCache)o.onClearCache()}function b(){var e=Object.keys(s);_.each(e,function(e){if(_.isArray(s[e])){for(var t=s[e].length;t>-1;t-=1)if(w(s[e][t]))s[e].splice(t,1);if(!s[e].length){s[e]=null;delete s[e]}}else if(w(s[e])){s[e]=null;delete s[e]}})}function w(e){if(!e||_.isEmpty(e.visits))return true;if(Date.now()-e.visits[e.visits.length-1]>r&&e.count<a)return true}function k(e,t){_.each(s,function(n){if(!e&&n._reduced)return;if(Array.isArray(n))_.each(n,function(e){t(e)});else t(n)})}var x={query:c,record:u,getMostCommon:g,getMostCommonWithPrefix:p,_getCache:S,_setCache:T,_clearCache:y,_pruneCache:b,_test:{_REDUCED_MULTIPLIER:i,_PRUNE_BELOW_COUNT:a,_traverseCache:k}};l[e]=x;return x}var l={}})()},4296:function(e,t){(function(){"use strict";TS.registerModule("ui.frecency",{onStart:function e(){if(TS.client)TS.client.before_login_sig.addOnce(n);if(TS.web)TS.web.before_login_sig.addOnce(n);TS.prefs.frecency_jumper_changed_sig.add(i)},record:function t(){e.record.apply(this,arguments)},query:function t(){return e.query.apply(this,arguments)},clearCache:function t(){e._clearCache.apply(this)},getMostCommonWithPrefix:function t(){return e.getMostCommonWithPrefix.apply(this,arguments)},isEnterprise:function e(){return TS.boot_data.feature_enterprise_frecency&&TS.boot_data.page_needs_enterprise},bonus_points:{starred_channel:10,member_of_this_channel:10,archived_channel_or_group:-50,not_in_channel:-25,usergroup_or_keyword:-25,fuzzy_match:50,exact_match:100,matches_previous_name:-50}});var e;var t=6e4;var n=function n(){e=TS.frecency.construct("jumper",{onStart:function e(){r=TS.utility.throttleFunc(r,t,true);return TS.model.frecency_jumper},recordFunc:function e(t){TS.model.frecency_jumper=t;r()},onClearCache:function e(){TS.prefs.setPrefByAPI({name:TS.ui.frecency.isEnterprise()?"frecency_ent_jumper":"frecency_jumper",value:"{}"})}})};var i=function t(){e._setCache(TS.model.frecency_jumper)};var r=function e(){TS.prefs.setPrefByAPI({name:TS.ui.frecency.isEnterprise()?"frecency_ent_jumper":"frecency_jumper",value:JSON.stringify(TS.model.frecency_jumper)})}})()},4298:function(e,t){(function(){"use strict";TS.registerModule("fuzzy",{onStart:function e(){},score:function e(t,n,i){if(!i)i={};var r=TS.fuzzy.makeFuzzyMatcher(n,i);return r.score(t)},makeFuzzyMatcher:function e(i,a){var o=s(i);if(null==a.fuzzy_limit)a.fuzzy_limit=Infinity;return{score:function e(i){var s=c(i,o);if(!s)return Infinity;if(!o)return Infinity;var l=r(i);if(!l)return Infinity;var u=n(l,o,a);if(!u)return Infinity;var d=t(u);if(d>a.fuzzy_limit)return Infinity;return d}}},test:function e(){return{lettersToGraph:r,queryToLinkedList:s}}});var e=" -_'.’​()";var t=function e(t){if(!t)return 0;return t.count+e(t.next)};var n=function e(t,n,r){var a=i(t,n,0,r);if(!a)a=_.reduce(t.jumps,function(e,a){if(e||a===t)return e;return i(a,n,1,r)},null);return a};var i=function e(t,n,i,r){if(!t)return null;var a;if(!t.visited&&(t.letter===n.letter||t.ignored&&n.is_separator))a={node:t,count:i};if(!a)return null;if(!n.next)return a;t.visited=true;var o=e(t.next,n.next,0,r);var s=n.next;if(s.is_space)if(s.next)s=s.next;if(!o)o=_.reduce(t.jumps,function(n,i){if(n)return n;if(i.visited||i===t)return n;if(r.search_forward_only||r.substrings_only)if(i.index<t.index)return n;if(r.substrings_only)if(i.index>t.index+2)return n;return e(i,s,1,r)},null);t.visited=false;if(o){a.next=o;return a}return null};var r=function e(t){var n=t.split("");var i=n.shift();return a(i,null,n,[],0)};var a=function e(t,n,i,r,a){if(!t)return null;var s=o(t,n,r,a);if(!n||n.ignored&&!s.ignored)r.push(s);var l=e(i.shift(),s,i,r,a+1);if(l)s.next=l;return s};var o=function t(n,i,r,a){return{letter:n,ignored:-1!==e.indexOf(n),next:null,prev:i,jumps:r,visited:false,index:a}};var s=function e(t){if(!t)return null;var n=t.split("");return l(n,0)};var l=function t(n,i){if(i>=n.length)return null;var r=n[i];var a=-1!==e.indexOf(r)&&(0!==i||n.length>1);var o=" "===r;return{letter:r,is_separator:a,is_space:o,next:t(n,i+1),index:i}};var c=function e(t,n){if(!n)return true;if(TS.boot_data.feature_tinyspeck&&(_.isUndefined(t)||null===t))TS.warn("_containsAllLetters: str passed in was not defined: ",t);var i=n.is_separator||-1!==t.indexOf(n.letter);if(!i)return false;return e(t,n.next)}})()},4300:function(e,t){(function(){"use strict";TS.registerModule("ui.team_picker",{STYLES:{normal:"normal",small:"small"},onStart:function e(){},make:function n(i,r,a){r=r||{};var o;var s;var l;if(!r.append&&!(TS.useReactLFS()&&a))i.addClass("hidden");r.style=_.get(TS.ui.team_picker.STYLES,r.style,TS.ui.team_picker.STYLES.normal);var c={append:!!r.append,data:e(r.teams||[],r.preselected_ids||[],r.disabled_ids||[]),approx_item_height:38,per_page:50,placeholder_text:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Add workspaces","team_picker")():TS.i18n.t("Add teams","team_picker")(),classes:"team_picker",restrict_preselected_item_removal:r.restrict_preselected_item_removal||false,single:!!r.single,style:r.style,template:function e(t){if(TS.useReactLFS()&&a)return TS.interop.lazyFilterSelect.teamPickerListItem(t);var n=TS.templates.invite_team_small({team:t.team});return new Handlebars.SafeString(n)},tokenTemplate:function e(t){if(TS.useReactLFS()&&a)return TS.interop.lazyFilterSelect.teamPickerToken(t);var n=TS.templates.invite_team_token({team:t.team});return new Handlebars.SafeString(n)},filter:function e(n,i){var r=n.team;if(o!==i){s=new RegExp("^"+TS.utility.regexpEscape(i),"i");l=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(i),"i");o=i}return t(r,s)||t(r,l)},noResultsTemplate:function e(t){if(!t)return TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("No workspaces found","team_picker")():TS.i18n.t("No teams found","team_picker")();return TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("No workspaces found matching <strong>{query}</strong>","team_picker")({query:_.escape(t)}):TS.i18n.t("No teams found matching <strong>{query}</strong>","team_picker")({query:_.escape(t)})}};if(TS.useReactLFS()&&a){c=_.assign({},c,{approxItemHeight:c.approx_item_height,items:c.data,onValueChange:r.onValueChange,placeholderText:c.placeholder_text,restrictPreselectedItemRemoval:c.restrict_preselected_item_removal,onListShown:function e(){TS.ui.lazy_filter_select.is_list_open=true;TS.kb_nav.pause(true)},onListHidden:function e(){TS.ui.lazy_filter_select.is_list_open=false;TS.kb_nav.pause(false)}});TS.interop.mountLazyFilterSelect(i,c)}else i.lazyFilterSelect(c)},value:function e(t){return t.lazyFilterSelect("value")}});var e=function e(t,n,i){return t&&t.map(function(e,t){return{id:String(t),team:e,disabled:-1!==i.indexOf(e.id),preselected:-1!==n.indexOf(e.id)}})};var t=function e(t,n){return t.name&&t.name.match(n)}})()},4303:function(e,t){(function(){"use strict";TS.registerModule("signup",{ERROR_BAD_EMAIL_DOMAIN:"bad_email_domain",ERROR_DOMAIN_NOT_FOUND:"domain_not_found",ERROR_INVALID_CODE:"invalid_code",ERROR_MISC:"misc",ERROR_MISSING_ARGS:"missing_args",ERROR_MISSING_USERNAME:"missing_username",ERROR_NO_EMAIL:"no_email",ERROR_NO_EMAIL_MISC:"no_email_misc",ERROR_NO_TEAM_NAME:"no_team_name",ERROR_NO_URL:"no_url",ERROR_NO_USERNAME:"no_username",ERROR_RATELIMITED:"ratelimited",ERROR_URL_BAD:"url_bad",ERROR_URL_LONG:"url_long",ERROR_URL_NO_LETTER:"url_no_letter",ERROR_URL_START_END_DASH:"url_start_end_dash",ERROR_URL_TAKEN:"url_taken",ERROR_USERNAME_BAD:"username_bad",ERROR_USERNAME_LONG:"username_long",ERROR_USERNAME_NOT_ALLOWED:"username_not_allowed",ERROR_USERNAME_START:"username_start",ERROR_USERNAME_TAKEN:"username_taken",ERROR_NAME_IS_SLACKBOT:"name_is_slackbot",onStart:function e(){l=window.callSlackAPIUnauthed?window.callSlackAPIUnauthed:TS.api.call},isBadSignupDomain:function e(t){if(void 0!==c[t])return Promise.resolve(c[t]);return new Promise(function(e){l("signup.checkEmailDomain",{domain:t},function(n,i){c[t]=!i.ok;e(!i.ok)})})},checkEmail:function e(t,n){var i=TS.utility.email.validateEmail(t,1);if(!i.is_valid)return Promise.resolve({is_valid:false,error_key:i.error_key,error_message:i.error_message});n=n||{};var r=n.timeout||2e3;var a=t.split("@")[1];n.get_info=n.get_info&&void 0===u[a];var o=n.get_info;if(o&&r){var s;var l;var c;f(t,a,n).then(function(e){if(!l){l=true;s(e);clearInterval(c)}});c=setTimeout(function(){if(!l)f(t,a).then(function(e){if(!l){l=true;s(e)}})},r);return new Promise(function(e){s=e})}return f(t,a,{get_info:o})},verifyEmailConfirmationCode:function e(t,n){var i={email:t,code:n};return new Promise(function(e){l("signup.confirmCode",i,function(t,n){if(t)return e({is_valid:true,api_response:n});var i=n.error;if("failed"===i)i=TS.signup.ERROR_INVALID_CODE;return e({is_valid:false,error_key:i,error_message:TS.signup.getErrorMessage(i)})})})},checkUsernameSyntax:function e(t){var i;if(!t||!t.length)i=TS.signup.ERROR_MISSING_USERNAME;else if(t.length>n)i=TS.signup.ERROR_USERNAME_LONG;else if(!o.test(t))i=TS.signup.ERROR_USERNAME_BAD;else if(!s.test(t))i=TS.signup.ERROR_USERNAME_START;if(i)return{is_valid:false,error_key:i,error_message:TS.signup.getErrorMessage(i)};return{is_valid:true}},checkUsernameAvailability:function t(n,i){var r=TS.signup.checkUsernameSyntax(n);if(!r.is_valid)return Promise.resolve({is_valid:false,error_key:r.error_key,error_message:r.error_message});var a={username:n};i=i||{};if(i.team_id)a.team_id=i.team_id;if(i.lead_id)a.lead_id=i.lead_id;return new Promise(function(t){l("signup.checkUsername",a,function(r,a){if(r)return t({is_valid:true});var o=a.error;var s;if(a.error===TS.signup.ERROR_USERNAME_NOT_ALLOWED)s=e[o]({username:_.escape(n)});else if("taken"===a.error)o=TS.signup.ERROR_USERNAME_TAKEN;var l={is_valid:false,error_key:o,error_message:s||TS.signup.getErrorMessage(o)};if(!i.get_suggestions)return t(l);if(!i.email){TS.warn("TS.signup.checkUsernameAvailability can only try to get username suggestions when options.email is set");return t(l)}TS.signup.suggestUsernameFromEmail(i.email).then(function(e){if(e.has_suggestion){l.has_suggestion=true;l.suggestion=e.username}return t(l)})})})},suggestUsernameFromEmail:function e(t,i){var r=t.toLocaleLowerCase().match(/^[a-z0-9]+/gi);if(r)r=r[0];if(!r||r.length>n)return Promise.resolve({has_suggestion:false});return new Promise(function(e){i=i||{};var t={lead_id:i.lead_id,get_suggestions:false};TS.signup.checkUsernameAvailability(r,t).then(function(t){if(t.is_valid)return e({has_suggestion:true,username:r});return e({has_suggestion:false})})})},checkNameSyntax:function e(t){if(t&&"slackbot"===t.toLocaleLowerCase()){var n=TS.signup.ERROR_NAME_IS_SLACKBOT;return{is_valid:false,error_key:n,error_message:TS.signup.getErrorMessage(n)}}return{is_valid:true}},checkURLSyntax:function e(n){var o;if(n.length>t)o=TS.signup.ERROR_URL_LONG;else if(!i.test(n))o=TS.signup.ERROR_URL_BAD;else if(a.test(n))o=TS.signup.ERROR_URL_START_END_DASH;else if(!r.test(n))o=TS.signup.ERROR_URL_NO_LETTER;if(o)return{is_valid:false,error_key:o,error_message:TS.signup.getErrorMessage(o)};return{is_valid:true}},checkURLAvailability:function e(t,n,i){if(!t||!n){TS.error("TS.signup.checkURLAvailability missing arguments");return Promise.resolve({is_valid:false,error_key:TS.signup.ERROR_MISSING_ARGS,error_message:TS.signup.getErrorMessage(TS.signup.ERROR_MISSING_ARGS)})}var r=TS.signup.checkURLSyntax(t);if(!r.is_valid)return Promise.resolve({is_valid:false,error_key:r.error_key,error_message:r.error_message});var a={email:n,url:t};i=i||{};if(i.lead_id)a.lead_id=i.lead_id;return new Promise(function(e){l("signup.checkURL",a,function(r,a){if(r)return e({is_available:true});else if("ratelimited"===a.error)return e({error_key:TS.signup.ERROR_RATELIMITED,error_message:TS.signup.getErrorMessage(TS.signup.ERROR_RATELIMITED)});if("bad"===a.error)a.error=TS.signup.ERROR_URL_BAD;if("taken"===a.error)a.error=TS.signup.ERROR_URL_TAKEN;var o={is_available:false,error_key:a.error,error_message:TS.signup.getErrorMessage(a.error)};if(!i.get_suggestions)return e(o);TS.signup.suggestURL(t,n).then(function(t){o.available=t.available;o.unavailable=t.unavailable;return e(o)})})})},suggestURL:function e(t,n){if(!t||!n){TS.error("TS.signup.suggestURL missing arguments");return Promise.resolve({error_key:TS.signup.ERROR_MISSING_ARGS,error_message:TS.signup.getErrorMessage(TS.signup.ERROR_MISSING_ARGS)})}var i={email:n,url:t};return new Promise(function(e){l("signup.suggestURL",i,function(t,n){if(t)return e({available:n.available,unavailable:n.unavailable});return e({error_key:n.error})})})},createTeam:function t(n){if(d)return Promise.resolve(false);d=true;return new Promise(function(t){l("signup.createTeam",n,function(i,r){d=false;if(i)return t({team_created:true,signin_url:r.url,user_id:r.user_id,team_id:r.team_id,team_id_raw:r.team_id_raw,api_token:r.api_token,valid_signup_domain:r.valid_signup_domain});var a;if(r.error===TS.signup.ERROR_BAD_EMAIL_DOMAIN&&TS.utility.email_regex.test(n.email)){var o=_.escape(n.email.split("@")[1]);a=e[r.error]({email_domain:o})}return t({team_created:false,error_key:r.error,error_message:a||TS.signup.getErrorMessage(r.error)})})})},getErrorMessage:function t(n,i){return(e[n]||e[TS.signup.ERROR_MISC])(i||{})},test:function t(){return{error_messages:e}}});var e={bad_email_domain:TS.i18n.t("Sorry, but we do not allow signups from @{email_domain}. Please pick a different email address!","signup"),domain_not_found:TS.i18n.t("Are you sure that address is typed correctly? If there are no mistakes, carry on!","signup"),invalid_code:TS.i18n.t("That code wasn’t valid. Give it another go!","signup"),missing_username:TS.i18n.t("Please fill in a username.","signup"),name_is_slackbot:TS.i18n.t("Sorry, slackbot is a reserved word. Try something else!","signup"),misc:TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","signup"),no_email:TS.i18n.t("For some really weird reason, we’re having trouble with your email. Please try again.","signup"),no_email_misc:TS.i18n.t("For some really weird reason, we’re having trouble with your email preferences. Please try again.","signup"),no_team_name:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("For some really weird reason, we’re having trouble with your workspace name. Please try again.","signup"):TS.i18n.t("For some really weird reason, we’re having trouble with your team name. Please try again.","signup"),no_url:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("For some reason, we’re having trouble with your personalized URL. Please try again.","signup"):TS.i18n.t("For some reason, we’re having trouble with your team URL. Please try again.","signup"),no_username:TS.i18n.t("For some really weird reason, we’re having trouble with your username. Please try again.","signup"),ratelimited:TS.i18n.t("Sorry, you’ve hit the rate limit. You’ll be able to try again soon.","signup"),url_bad:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Personalized URLs can only have letters, numbers, and dashes.","signup"):TS.i18n.t("Team URLs can only have letters, numbers, and dashes.","signup"),url_long:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Please enter up to 21 characters for your Personalized URL.","signup"):TS.i18n.t("Please enter up to 21 characters for your Team URL.","signup"),url_no_letter:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Please enter at least one letter for your Personalized URL.","signup"):TS.i18n.t("Please enter at least one letter for your Team URL.","signup"),url_start_end_dash:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Personalized URLs can’t start or end with a dash. Sorry!","signup"):TS.i18n.t("Team URLs can’t start or end with a dash. Sorry!","signup"),url_taken:TS.i18n.t("This URL is not available. Sorry!","signup"),username_bad:TS.i18n.t("Sorry, usernames can only contain letters, numbers, periods, hyphens, and underscores, with no spaces!","signup"),username_long:TS.i18n.t("Usernames cannot be longer than 21 characters.","signup"),username_not_allowed:TS.i18n.t("Oops, sorry! Your username can’t be {username}, as it’s reserved for other uses.","signup"),username_start:TS.i18n.t("Sorry, usernames must begin with a letter or number!","signup"),username_taken:TS.i18n.t("Sorry, but this username is not available! Please pick another one.","signup")};var t=21;var n=21;var i=new RegExp("^[a-z0-9-]+$","i");var r=new RegExp("[a-z]","i");var a=new RegExp("(^[-])|(.*[-])$","i");var o=new RegExp("^[a-z0-9-._]+$","i");var s=new RegExp("^[a-z0-9][a-z0-9-._]*$","i");var l;var c={};var u={};var d=false;var f=function t(n,i,r){var a=r&&r.get_info;var o={email:n,get_info:a};return new Promise(function(t){l("signup.checkEmail",o,function(n,r){if(n)return t({is_ok:true,api_response:r});var o;if(r.error===TS.signup.ERROR_BAD_EMAIL_DOMAIN)o=e[r.error]({email_domain:i});else if(r.error===TS.signup.ERROR_DOMAIN_NOT_FOUND)u[i]=false;else if(a)u[i]=true;return t({is_ok:false,error_key:r.error,error_message:o||TS.signup.getErrorMessage(r.error)})})})}})()},4304:function(e,t){(function(){"use strict";TS.registerModule("google_auth",{isAuthed:function e(n){return t[n]},pollForAuthStatus:function e(t,n,r,a){a=a||{};var o=a.interval||1e3;var s=a.max_attempts||Infinity;var l=0;var c;var u;var d=false;var _=function e(){l+=1;u=TS.google_auth.isAuthed(t);if(u||r&&r.closed){c=null;n(!!u)}else if(!d&&l<s){i(t);c=setTimeout(e,o)}};_();return{cancel:function e(){if(c)clearTimeout(c);d=true}}},getAuthLink:function e(t){if(n[t])return Promise.resolve(n[t]);return new Promise(function(e){TS.api.call("services.googlecontacts.oauth.init",{instance_id:t}).then(function(i){n[t]=i.data.auth_url;e(i.data.auth_url)})})},getContactList:function e(t,n){if(!TS.google_auth.isAuthed(t))return Promise.resolve([]);return new Promise(function(e){var i=[];TS.google_auth.getContactsFromAPI(t,n,i,function(t){e(t||[])})})},getContactsFromAPI:function e(t,n,i,r){TS.api.call("services.googlecontacts.list",{instance_id:t,page:n.page,count:n.count}).then(function(e){i.push.apply(i,e.data.contacts);if(false===e.data.all_items_fetched){n.page+=1;TS.google_auth.getContactsFromAPI(t,n,i,r)}else{var a={items:i,all_items_fetched:e.data.all_items_fetched};r(a)}})},getContactListFromQuery:function e(t,n){if(!TS.google_auth.isAuthed(t))return Promise.resolve([]);return new Promise(function(e){TS.api.call("services.googlecontacts.search",{instance_id:t,query:n.query,page:n.page,count:n.count}).then(function(t){var n={items:t.data.contacts,all_items_fetched:t.data.all_items_fetched};e(n||[])})})},isAppsEmail:function t(n,i){if(!TS.utility.email.validateEmail(n).is_valid)return Promise.resolve({error_key:"invalid_email"});var r=n.split("@")[1];if(void 0!==e[r])return Promise.resolve(e[r]);var a;var o;var s={email:n,get_info:true};var l=window.callSlackAPIUnauthed?window.callSlackAPIUnauthed:TS.api.call;return new Promise(function(t){l("signup.checkEmail",s,function(n,i){if(a){clearTimeout(a);a=null}if(n)e[r]={is_google:"google_apps"===i.type,auth_url:i.auth_url};if(!o)return t(e[r])});if(i)a=setTimeout(function(){TS.log(99,"TS.google_auth.isAppsEmail timed out after "+i/1e3+" seconds");a=null;o=true;return t({error_key:"timed_out"})},i)})}});var e={};var t={};var n={};var i=function e(n){return new Promise(function(e){TS.api.call("services.googlecontacts.oauth.hasAuth",{instance_id:n}).then(function(i){var r=i.data.has_auth;t[n]=r;e(r)})})}})()},4306:function(e,t){(function(){"use strict";TS.registerModule("utility.calls_analytics",{onStart:function e(){if(TS.calls){TS.calls.room_id_sig.add(s);TS.web.login_sig.add(l)}if(TS.client){TS.utility.calls.room_id_sig.add(s);TS.client.login_sig.add(l)}},teardown:function e(){clearTimeout(t);if(r.room_id)delete r.room_id},isStateClean:function e(){return _.isEmpty(r)},record:function e(r,a){var s=r.slice(0,r.indexOf("."));var l="video_send_stats"===s||"video_recv_stats"===s;if(l||!_.find(i,function(e){return e.measurement===r}))i.push(o(r,a));if(!t)t=setTimeout(TS.utility.calls_analytics.flush,n)},promiseToRecordImmediately:function e(t,n){var i={database:a(),points:[o(t,n)]};return TS.api.call("screenhero.rooms.proxyAnalytics",{data:JSON.stringify(i)},null,true).catch(_.noop)},flush:function e(){if(i.length){var n=Date.now();i=i.map(function(e){e.fields.posted_time=n;return e});TS.api.call("screenhero.rooms.proxyAnalytics",{data:JSON.stringify({database:a(),points:i})},null,true).catch(_.noop);i=[]}clearTimeout(t);t=void 0},logEvent:function t(n){var i;if(!(TS.model&&TS.model.user&&TS.model.user.id||r.room_id)){TS.warn("calls analytics module not ready: "+JSON.stringify(n));return}i=["user_event_logs"];if(r.room_id)i.push(r.room_id);else i.push(TS.model.user.id);$.extend(n||{},{user_id:TS.model.user.id,os:e.os,ssb_version:e.ssb_version,webapp_version:e.webapp_version});TS.utility.calls_analytics.record(i.join("."),n)}});var e={};var t;var n=5e3;var i=[];var r={};var a=function e(){return"dev"===TS.boot_data.version_ts?"calls_dev":"calls"};var o=function e(t,n){if("string"===typeof n||"number"===typeof n)n={value:n};n.value=JSON.stringify(n.value);n.client_time=Date.now();return{measurement:t,fields:n}};var s=function e(t){r.room_id=t.room_id};var l=function t(){if(TS.model.is_mac)e.os="mac";else if(TS.model.is_win)e.os="win";else if(TS.model.is_lin)e.os="lin";else e.os=navigator.userAgent;e.webapp_version=TS.boot_data.min_sh_version_ts;if(TS.model.mac_ssb_version)if(window.macgap&&macgap.screenhero&&macgap.screenhero.getAppVersion)e.ssb_version=macgap.screenhero.getAppVersion();else e.ssb_version=TS.model.mac_ssb_version+"."+TS.model.mac_ssb_version_minor;else if(TS.model.win_ssb_version)e.ssb_version=TS.model.win_ssb_version+"."+TS.model.win_ssb_version_minor;else if(TS.model.lin_ssb_version)e.ssb_version=TS.model.lin_ssb_version+"."+TS.model.win_lin_version_minor;else e.ssb_version="N/A"}})()},4307:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility.calls_log",{enableDevLogging:function e(){if("dev"===TS.boot_data.version_ts)TS.pri="123,"+TS.pri},enableBuffering:function t(n){e.enable_buffering=n},logInfo:function e(){var t=r.apply(null,arguments);TS.info(t);i(t,"INF")},logWarn:function e(){var t=r.apply(null,arguments);TS.warn(t);i(t,"WRN")},logError:function e(){var t=r.apply(null,arguments);TS.error(t);i(t,"ERR")},logEvent:function e(t){a(t,"EDBG",true)},logEventInfo:function e(t){a(t,"EINF",true)},logEventWarn:function e(t){a(t,"EWRN",false)},logEventError:function e(t){a(t,"EERR",false)},getAndClearBuffer:function n(){var i=t.buffer.join("\n");if(t.buffer_overflow)i+=e.excess;t.buffer=[];t.buffer_length=0;t.buffer_overflow=false;return i}});var e={enable_buffering:false,MAX_LENGTH:3e4,excess:"... log is too long"};var t={buffer:[],buffer_length:0,buffer_overflow:false};var i=function n(i,r){var a;if(false===e.enable_buffering)return;a="["+r+"|"+TS.makeLogDate()+"]:";if(a.length+i.length+t.buffer_length+e.excess.length<e.MAX_LENGTH)t.buffer.push(a+i);else t.buffer_overflow=true};var r=function e(){var t=[];for(var i=0;i<arguments.length;i+=1){if(!arguments[i])continue;if("object"===n(arguments[i]))t.push(JSON.stringify(arguments[i]));else t.push(arguments[i].toString())}return t.join(" ")};var a=function e(t,n,a){var o=r(t.value);var s=t.event+": "+o;switch(n){case"EDBG":break;case"EINF":TS.info(s);break;case"EWRN":TS.warn(s);break;case"EERR":TS.error(s)}if(!a)TS.utility.calls_analytics.logEvent($.extend(t,{level:n}));i(s,n)}})()},4311:function(e,t){(function(){"use strict";TS.registerModule("incoming_call",{div:null,is_showing:false,default_setting:{onAccept:null,onReject:null,onTimeout:null,onShow:null,onEnd:null},current_setting:null,Q:[],onKeydown:function e(t){if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){TS.incoming_call.accept();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc)if("BODY"===TS.utility.getActiveElementProp("NODENAME"))TS.incoming_call.reject()},start:function e(t){if(TS.incoming_call.is_showing){if(t.unique&&TS.incoming_call.current_setting.unique==t.unique)TS.info("redundant generic dialog not Qed: "+t.unique);else TS.incoming_call.Q.push(t);return}TS.incoming_call.current_setting=_.defaults({},t,TS.incoming_call.default_setting);var n=TS.incoming_call.current_setting;if(!TS.incoming_call.div)TS.incoming_call.build();var i=TS.incoming_call.div;var r=TS.templates.calls_incoming_call({caller:t.caller,name:t.name,is_video_call:t.is_video_call,team:TS.model.team.name});i.empty();i.html(r);i.find(".accept_audio").click(function(){TS.incoming_call.accept(false)});i.find(".accept_video").click(function(){TS.incoming_call.accept(true)});i.find(".reject").click(TS.incoming_call.reject);i.modal("show");if(document.activeElement&&document.activeElement!=document.body)document.activeElement.blur();if(n.onShow)n.onShow()},accept:function e(t){if(!TS.incoming_call.is_showing){TS.error("incoming call not showing?");return}var n=TS.incoming_call.current_setting;var i=TS.incoming_call.div;i.modal("hide");n.onAccept(t)},reject:function e(){var t=TS.incoming_call.current_setting;TS.incoming_call.div.modal("hide");if(t.onReject)t.onReject()},timeout:function e(){var t=TS.incoming_call.current_setting;TS.incoming_call.div.modal("hide");if(t.onTimeout)t.onTimeout()},end:function e(){var t=TS.incoming_call.current_setting;TS.model.dialog_is_showing=false;TS.incoming_call.is_showing=false;$(window.document).unbind("keydown",TS.incoming_call.onKeydown);TS.incoming_call.div.empty();if(t.onEnd)t.onEnd();if(!TS.incoming_call.is_showing&&TS.incoming_call.Q.length){var n=TS.incoming_call.Q.shift();TS.incoming_call.start(n)}},build:function e(){$("body").append('<div id="incoming_call" class="modal hide" data-keyboard="false" data-backdrop="static"></div>');TS.incoming_call.div=$("#incoming_call");var t=TS.incoming_call.div;t.on("hidden",function(e){if(e.target!=this)return;TS.incoming_call.end()});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.incoming_call.is_showing=true});t.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){if(!TS.incoming_call.is_showing)return;t.find(".title_input").select();$(window.document).bind("keydown",TS.incoming_call.onKeydown)},100)})}})})()},4312:function(e,t){(function(){"use strict";TS.registerModule("inline_room_previews",{onStart:function e(){},toggle_sig:new signals.Signal,checkForInlineRoomPreviewClick:function e(t){var n=$(t.target);var i=n.closest(".message");if(!i.length)return;if(n.closest(".msg_inline_room_preview_expander, .msg_inline_room_preview_collapser").length){t.preventDefault();TS.inline_room_previews.toggle(i);return}if(n.closest(".screenhero_attachment").length&&!n.hasClass("screenhero_room_link"))i.find(".screenhero_room_link").click()},shouldExpand:function e(t){var n=TS.model.expandable_state["inline_room_"+t];var i=TS.model.prefs.expand_internal_inline_imgs;return void 0===n?i:!!n},toggle:function e(t){var n=t.find(".sh_call_container");var i=n.hasClass("sh_call_collapsed");var r=TS.client&&TS.client.ui.areMsgsScrolledToBottom();TS.model.expandable_state["inline_room_"+n.data("room-id")]=i;TS.storage.storeExpandableState(TS.model.expandable_state);n.toggleClass("sh_call_collapsed");TS.inline_room_previews.toggleIcons(t);TS.inline_room_previews.toggle_sig.dispatch(t);if(TS.client&&r)TS.client.ui.instaScrollMsgsToBottom(false)},expand:function e(){},collapse:function e(){},toggleIcons:function e(t){t.find(".msg_inline_room_preview_collapser, .msg_inline_room_preview_expander").toggleClass("hidden")},expandAllInCurrent:function e(){$(".msg_inline_room_preview_expander").trigger("click");if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_room_preview_collapser").trigger("click")}})})()},4314:function(e,t){(function(){"use strict";TS.registerModule("ui.basic_share_dialog",{start:function n(i){e=i;var a=TS.templates.basic_share_dialog({attachment_html:new Handlebars.SafeString(i.attachment_html),warning:i.warning,show_copy_link:!!i.copy_link&&TS.clipboard.canWriteText(),copy_text:i.copy_text});var o="basic_share_dialog";var s=TS.i18n.t("Share","basic_share_dialog")();if(i.dialog_class)o+=" "+i.dialog_class;TS.generic_dialog.start({title:i.title||s,go_button_text:i.go_button_text||s,dialog_class:o,body:a,onShow:t,onEnd:r,onGo:i.onGo})}});var e;var t=function t(){var r=$("#generic_dialog.basic_share_dialog");r.css("display","");var o=r.find("#share_dialog_input_container");var s=[];if(TS.boot_data.feature_texty_takes_over)s=[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members];TS.ui.inline_msg_input.make(o,{aria_label:TS.i18n.t("Add optional comment before sharing.","basic_share_dialog")(),no_emo:false,placeholder:TS.i18n.t("Add a message, if you’d like.","basic_share_dialog")(),onEnter:TS.generic_dialog.go,onEscape:TS.generic_dialog.cancel,onTextChange:n,onTab:i,completers:s});var l=o.find(".message_input");l.attr("id","file_comment_textarea");var c=e.initial_message||"";TS.utility.contenteditable.value(l,c);var u=r.find("#file_sharing_div");u.prependTo(r.find(".modal-footer"));var d=true;TS.ui.file_share.bindFileShareDropdowns(d,e.src_model_ob,void 0,true);u.find("#select_share_channels").css({width:""});var _=$("#share_dialog_warning");if(_.length){u.addClass("hidden");_.prependTo(r.find(".modal-footer"))}var f=r.find('[data-action="copy_link"]');if(f.length){r.find(".dialog_cancel").before(f);f.removeClass("hidden");f.click(a)}TS.generic_dialog.div.on("shown",function e(){TS.generic_dialog.div.off("shown",e);TS.utility.contenteditable.focus(l)});r.find(".share_dialog_attachment_container").find("a[href]","button").attr("tabindex","-1");if(e.onShow)e.onShow();if(TS.boot_data.feature_texty_takes_over)return;l.on("keydown",function(e){if(e.which===TS.utility.keymap.esc){if(TS.utility.contenteditable.isEmpty(l)){e.preventDefault();TS.generic_dialog.cancel()}}else if(e.which===TS.utility.keymap.enter){if(!e.shiftKey&&!e.altKey&&!l.tab_complete_ui("isShowing")){e.preventDefault();TS.generic_dialog.go()}}else if(e.which===TS.utility.keymap.tab&&u.find(".lfs_input_container:visible").length&&!e.shiftKey&&!l.tab_complete_ui("isShowing")&&!l.tab_complete_ui("hasMatches")){if(!TS.boot_data.feature_keyboard_navigation)e.preventDefault();i()}}).on("textchange",function(){n()})};var n=function e(){TS.ui.file_share.updateAtChannelWarningNote();TS.ui.file_share.updateAtChannelBlockedNote()};var i=function e(){$("#file_sharing_div").find(".lfs_input_container").click();return TS.boot_data.feature_keyboard_navigation};var r=function t(){if(e.onEnd)e.onEnd();e=null};var a=function t(){if(!e.copy_link||!TS.clipboard.canWriteText())return;TS.tips.updateFloater({title:TS.i18n.t("Copied!","basic_share_dialog")(),classes_to_add:["success"]});TS.clipboard.writeText(e.copy_link)}})()},4315:function(e,t){(function(){"use strict";TS.registerModule("ui.share_message_dialog",{start:function a(s,l,c){var u=TS.utility.msgs.findMsg(s,l.id);if(!u){TS.error("wtf no msg?");return}TS.tips.hideAll();e=s;if(!_.isString(s))e=s.toString();t=l;n=false;var d=TS.templates.builders.formatMessageAsAttachment(u,l);var f=TS.i18n.t("Copy a link to this message.<br>To share, paste it anywhere.","share_message")();var m;if(!o()){f=TS.i18n.t("Copy a link to this message.<br>It’s private, so sharing is limited.","share_message")();m=TS.templates.share_message_dialog_warning({from_private_channel:(l.is_private||l.is_group)&&!l.is_mpim});m=new Handlebars.SafeString(m)}TS.ui.basic_share_dialog.start({title:TS.i18n.t("Share message","share_message")(),go_button_text:TS.i18n.t("Share","share_message")(),initial_message:c,attachment_html:d,warning:m,copy_link:TS.utility.msgs.constructAbsoluteMsgPermalink(t,e,u.thread_ts),copy_text:f,onGo:r,onEnd:i,src_model_ob:t})}});var e;var t;var n;var i=function n(){e=null;t=null;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"close",trigger:"share_message_dialog"}}});TS.tips.unhideAll()};var r=function i(){if(n)return;var r=e;var o=t;var s=TS.utility.contenteditable.value($(".basic_share_dialog .message_input"));var l=TS.format.cleanMsg(s);l=_.trim(l);var c=$(".basic_share_dialog #select_share_channels");var u=c.lazyFilterSelect("value")[0];if(u&&u.model_ob&&u.model_ob.create_channel){var d=e;var f=t;TS.ui.new_channel_modal.start(u.model_ob.name).then(function(e){t=f;a(d,l,f,e);return null}).catch(function(){TS.ui.share_message_dialog.start(d,f,l);return null});TS.generic_dialog.cancel();return false}if(!u){c.find(".lfs_input_container").addClass("error");return false}a(r,l,o,u.model_ob)};var a=function e(t,i,r,a){if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return false;var l=TS.utility.contenteditable.value($(".basic_share_dialog .message_input"));var c=$(".basic_share_dialog #select_share_channels");s(r.id,t);var u={channel:r.id,timestamp:t,text:i};if(o())if(a)u.share_channel=a.presence?"@"+a.name:a.id;else if(r.is_archived){$("#select_share_pick_channel_note").removeClass("hidden");_.defer(function(){c.find(".lfs_input_container").click()});return false}n=true;if(!a)a=r;var d;if(a&&a.is_channel&&!a.is_member)d=TS.channels.joinById(a.id);else d=Promise.resolve();d.then(function(){return TS.api.call("chat.shareMessage",u).then(function(){if(!TS.client)return;var e=TS.shared.getActiveModelOb();if(a&&e&&e.id===a.id&&!TS.model.threads_view_is_showing&&!TS.model.unread_view_is_showing)TS.client.ui.instaScrollMsgsToBottom();else if(u.share_channel&&a)return TS.client.displayModelOb(a)})}).catch(function(e){var n=e||"unknown error";if(e&&e.data&&e.data.error)n=e.data.error;TS.error("chat.shareMessage error: "+n);TS.generic_dialog.start({title:TS.i18n.t("Message could not be shared","share_message")(),body:TS.i18n.t("Sorry! Something went wrong.","share_message")(),go_button_text:TS.i18n.t("Try again","share_message")(),onGo:function e(){TS.ui.share_message_dialog.start(t,r,l)}})})};var o=function e(){return t.is_channel&&!t.is_private};var s=function e(t,n){if(!t||!n)return;var i={channel_id:t,message_id:n};var r="MSG_SHARED_CLICKED";var a=$("ts-message[data-model-ob-id='"+t+"'][data-ts='"+n+"']");_.merge(i,TS.ui.thread.getTrackingPayloadForEl(a));if("threads_view"===TS.ui.thread.getContextForEl(a))TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(r,i)}})()},4318:function(e,t){(function(){"use strict";TS.registerComponent("ui.ContextualDropDown",{_constructor:function d(_,f){f=f||{};this._show_description=f.show_description;this.updated_sig=new signals.Signal;var m=Array.prototype.slice.call(_.querySelectorAll("select option"));_.innerHTML=TS.templates.contextual_dropdown({show_description:f.show_description});this._dropdown=_.querySelector(".contextual_dropdown");this._dropdown_label=_.querySelector(".contextual_dropdown_label");this._dropdown_container=_.querySelector(".contextual_dropdown_container");if(f.show_description)this._dropdown_desc=_.querySelector(".contextual_dropdown_desc");this._onOpen=r.bind(this);this._onClose=a.bind(this);this._onItemClicked=s.bind(this);this._onItemMouseOver=l.bind(this);this._onItemMouseOut=c.bind(this);this._onItemPress=u.bind(this);this._onFocus=e.bind(this);this._onBlur=t.bind(this);this._onEnterPress=n.bind(this);this._onArrowPress=i.bind(this);this._dropdown_label.addEventListener("click",this._onOpen);this._dropdown_label.addEventListener("focus",this._onFocus);this._dropdown_label.addEventListener("blur",this._onBlur);var g=/(<([^>]+)>)/gi;var p="";var h;var v;var S;m.forEach(function(e){h=e.getAttribute("data-desc")||"";v=e.getAttribute("data-desc-disabled")||"";S=!!e.getAttribute("disabled");p+=TS.templates.contextual_dropdown_item({label:e.label,value:e.value,desc:h,desc_disabled:v,disabled:S,aria_label:(h||e.label).replace(g,"")})});var T=_.querySelector(".contextual_dropdown_items");T.innerHTML=p;this._items=Array.prototype.slice.call(T.querySelectorAll(".contextual_dropdown_item"));this._items.forEach(function(e){e.addEventListener("click",this._onItemClicked);e.addEventListener("keydown",this._onItemPress);if(f.show_description){e.addEventListener("mousemove",this._onItemMouseOver);e.addEventListener("focus",this._onItemMouseOver);e.addEventListener("mouseout",this._onItemMouseOut)}}.bind(this));if(this._items.length)if(f.start_value)o.call(this,T.querySelector('[data-value="'+f.start_value+'"]'));else if(f.select_first)o.call(this,this._items[0])},getSelectedItem:function e(){return this._current_item||null},getSelectedValue:function e(){if(!this._current_item)return null;return this._current_item.getAttribute("data-value")},destroy:function e(){this._onClose();this._dropdown_label.removeEventListener("click",this._onOpen);this._dropdown_label.removeEventListener("focus",this._onFocus);this._dropdown_label.removeEventListener("blur",this._onBlur);this._items.forEach(function(e){e.removeEventListener("click",this._onItemClicked);e.removeEventListener("keydown",this._onItemPress);if(this._show_description){e.removeEventListener("mousemove",this._onItemMouseOver);e.removeEventListener("focus",this._onItemMouseOver);e.removeEventListener("mouseout",this._onItemMouseOut)}}.bind(this))}});var e=function e(){document.addEventListener("keydown",this._onEnterPress)};var t=function e(){document.removeEventListener("keydown",this._onEnterPress)};var n=function e(t){if("Enter"===t.key)if(this._is_open)this._onClose();else this._onOpen();else if(!this._is_open&&"ArrowDown"===t.key){this._onOpen();this._onArrowPress(t)}};var i=function e(t){var n;if("ArrowDown"===t.key){n=this._items.indexOf(this._focused_item);if(n<this._items.length-1)n+=1;else n=0}else if("ArrowUp"===t.key){n=this._items.indexOf(this._focused_item);if(n>0)n-=1;else n=this._items.length-1}if(void 0!==n)this._items[n].focus()};var r=function e(t){if(t)t.stopPropagation();this._dropdown_label.removeEventListener("click",this._onOpen);document.body.addEventListener("click",this._onClose);document.addEventListener("keydown",this._onArrowPress);if(this._current_item){var n=this._current_item.getAttribute("data-desc");this._dropdown_desc.innerHTML=n}this._dropdown.classList.add("is_open");this._is_open=true;this._focused_item=null;this._dropdown_container.setAttribute("aria-hidden",false)};var a=function e(){document.body.removeEventListener("click",this._onClose);document.removeEventListener("keydown",this._onArrowPress);this._dropdown_label.addEventListener("click",this._onOpen);this._dropdown.classList.remove("is_open");this._is_open=false;this._dropdown_container.setAttribute("aria-hidden",true)};var o=function e(t,n){if(this._current_item&&this._current_item===t||!t)return;if(t.getAttribute("disabled")){if(n)n.stopPropagation();return}if(this._current_item)this._current_item.classList.remove("is_selected");this._current_item=t;this._current_item.classList.add("is_selected");this._dropdown_label.innerHTML=this._current_item.getAttribute("data-label");var i=this._current_item.getAttribute("data-desc");if(this._dropdown_desc)this._dropdown_desc.innerHTML=i;this.updated_sig.dispatch(this.getSelectedValue())};var s=function e(t){o.call(this,t.target,t)};var l=function e(t){if(this._focused_item===t.target)return;var n=t.target.getAttribute("disabled")?t.target.getAttribute("data-desc-disabled"):t.target.getAttribute("data-desc");this._dropdown_desc.innerHTML=n;if(this._focused_item)this._focused_item.blur();this._focused_item=t.target;this._focused_item.focus()};var c=function e(t){if(this._focused_item===t.target){this._focused_item.blur();this._focused_item=null}};var u=function e(t){if("Enter"===t.key){o.call(this,t.target,t);this._dropdown_label.focus();this._onClose();t.stopPropagation()}}})()},4319:function(e,t){(function(){"use strict";TS.registerModule("utility.slackbot",{getWithFeels:function n(i){var r=e();if(!r||!r.profile)return;t(r,i);return r}});function e(){return _.cloneDeep(TS.members.getMemberById("USLACKBOT"))}function t(e,t){switch(t){case"sad_surprise":e.profile.image_20=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_20.png";e.profile.image_24=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_24.png";e.profile.image_32=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_32.png";e.profile.image_36=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_36.png";e.profile.image_48=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_48.png";e.profile.image_72=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_72.png";e.profile.image_192=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_192.png";e.profile.image_512=cdn_url+"/c6db/img/slackbot/slackbot_sad_surprise_512.png";break;case"fancy":e.profile.image_20=cdn_url+"/c6db/img/slackbot/slackbot_fancy_20.png";e.profile.image_24=cdn_url+"/c6db/img/slackbot/slackbot_fancy_24.png";e.profile.image_32=cdn_url+"/c6db/img/slackbot/slackbot_fancy_32.png";e.profile.image_36=cdn_url+"/c6db/img/slackbot/slackbot_fancy_36.png";e.profile.image_48=cdn_url+"/c6db/img/slackbot/slackbot_fancy_48.png";e.profile.image_72=cdn_url+"/c6db/img/slackbot/slackbot_fancy_72.png";e.profile.image_192=cdn_url+"/c6db/img/slackbot/slackbot_fancy_192.png";e.profile.image_512=cdn_url+"/c6db/img/slackbot/slackbot_fancy_512.png";break;default:TS.warn("Slackbot doesn't have an avatar for that feeling.")}}})()},4320:function(e,t){(function(){"use strict";TS.registerModule("utility.welcome_post",{WELCOME_POST_NAME:"Getting_started_with_Slack__team_creator_welcome_post_identifier",clogWelcomePostExpand:function e(t){if(t&&t.name===TS.utility.welcome_post.WELCOME_POST_NAME)if(TS.model.user.is_primary_owner)TS.clog.track("WEBSITE_CLICK",{click_target:"expand_post_button",trigger:"welcome_post_team_creator",action:"open_post"});else TS.clog.track("WEBSITE_CLICK",{click_target:"expand_post_button",trigger:"welcome_post_team_joiner",action:"open_post"})},clogWelcomePostOpen:function e(t){var n=t.data("file-id");var i=TS.files.getFileById(n);if(i&&i.name===TS.utility.welcome_post.WELCOME_POST_NAME)if(TS.model.user.is_primary_owner)if(t.hasClass("welcome_post_slackbot_message"))TS.clog.track("WEBSITE_CLICK",{click_target:"edit_post_link",trigger:"welcome_post_team_creator",action:"open_post"});else TS.clog.track("WEBSITE_CLICK",{click_target:"edit_in_new_window_button",trigger:"welcome_post_team_creator",action:"open_post"});else TS.clog.track("WEBSITE_CLICK",{click_target:"open_in_new_window_button",trigger:"welcome_post_team_joiner",action:"open_post"})},clogWelcomePostSetting:function e(t){if(t)TS.clog.track("WEBSITE_CLICK",{click_target:"save_welcome_post_setting",trigger:"button_click",action:"enable"});else TS.clog.track("WEBSITE_CLICK",{click_target:"save_welcome_post_setting",trigger:"button_click",action:"disable"})}})})()},4322:function(e,t){(function(){"use strict";TS.registerModule("ui.unsaved_form_warning",{onStart:function e(){$("form[data-unsaved-form-warning]").each(function(e,t){var n=$(t).serializeArray();var i=false;if(t.hasAttribute("data-validation-form"))TS.ui.validation.completed_sig.add(function(e,n){if(n.passed&&e[0]===t)i=true});else $(t).on("submit",function(){i=true});$(window).on("beforeunload",function(){if(!i&&!_.isEqual(n,$(t).serializeArray()))return TS.i18n.t("Changes you made may not be saved.","unsaved_warning")()})})}})})()},4323:function(e,t){(function(){"use strict";TS.registerModule("ui.pins",{onStart:function e(){TS.pins.pins_fetched_sig.add(TS.ui.pins.rebuildPinnedMessagesUI);TS.pins.pinned_status_changed_sig.add(TS.ui.pins.updatePinUI)},updatePinUI:function i(r,a,o){if(!r||!a)return;if("file"===a.type)t(r,a.file,o);else if("file_comment"===a.type)n(r,a.comment,o);if("message"===a.type)e(r,a.message,o)},rebuildPinnedMessagesUI:function e(t,n){if(!n||0===n.length)return;n.forEach(function(e){TS.ui.pins.updatePinUI(t,e,true)})},clearUnreadPinState:function e(){TS.client.channel_header.clearUnreadPinState();TS.client.channel_page.clearUnreadPinState()}});var e=function e(t,n,i){if(!t||!n||!n.ts)return;var r=TS.templates.makeMsgDomId(n.ts);var a=$("#messages_container #"+r+', #messages_container .message_unfurl[data-attachment-ts="'+n.ts+'"]');var o=a.find(".is_pinned_holder:first");if(0===a.length||0===o.length)return;if(i){a.addClass("is_pinned");o.html(TS.templates.builders.buildPinInfoHtml(n).string)}else{a.removeClass("is_pinned");o.empty()}};var t=function e(t,n,r){if(!t||!n)return;var a=$('.message_body[data-file-id="'+n.id+'"]');var o=a.closest("ts-message");i(t,o,r)};var n=function e(t,n,r){if(!t||!n)return;var a=$(".rxns_key_"+n._rxn_key);var o=a.closest("ts-message");i(t,o,r)};var i=function t(n,i,r){if(!n||0===i.length)return;_.forEach(i,function(t){var i=$(t).data("ts");if(!i)return;t=TS.utility.msgs.getMsg(i,n.msgs);if(!t)return;e(n,t,r)})}})()},4324:function(e,t){(function(){"use strict";TS.registerComponent("PromiseQueue",{_constructor:function e(){this.queue=[];this.current_job=null},destroy:function e(){this.clear()},clear:function e(){this.queue=[];if(this.current_job&&this.current_job.isPending())this.current_job.cancel();this.current_job=null},addToQ:function e(t){return new Promise(function(e,n){this.queue.push(function(){var i=t();if(!i||!i.then)i=Promise.resolve();i.then(e,n);return i});if(1===this.queue.length&&!this.current_job)return this._nextFromQ()}.bind(this))},_nextFromQ:function e(){if(this.current_job)return;if(!this.queue.length)return;var t=this.queue.shift();var n=t();this.current_job=n;n.finally(function(){this.current_job=null;this._nextFromQ();return null}.bind(this));return null}})})()},4333:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility.number",{onStart:function e(){},formatNumberWithAbbreviation:function e(t,i){if(isNaN(t)){TS.error("Expected input to be a string, got: "+("undefined"===typeof t?"undefined":n(t)));return}if(t<999)return String(t);i=i||{};var r=TS.i18n.locale();var a=TS.i18n.number_abbreviations[r]||TS.i18n.number_abbreviations["en-US"];var o;var s=_.get(i,"abbreviation");var l=_.get(i,"precision",4);if(l>21||l<1||isNaN(l)){TS.warn("Precision must be a value between 1 and 21. Formatting with default precision (4) instead.");l=4}var c=t.toPrecision(l);switch(s){case"K":o=3;break;case"M":o=6;break;case"B":o=9;break;case"T":o=12;break;default:var u=Math.floor(parseFloat((Math.log(c)/Math.LN10).toPrecision(12)));if(u>=12)o=12;else if(u>=9)o=9;else if(u>=6)o=6;else if(u>=3)o=3;else o=0}var d=c/Math.pow(10,o);var f=a[o];if(_.get(i,"lowercase"))f=f.toLowerCase();if(!_.includes(String(d),"."))return d+f;var m=parseFloat(d.toPrecision(l));var g=_.get(i,"decimal_places");if(g){var p=Math.pow(10,g);m=Math.floor(m*p)/p}return m+f},formatNumberToDecimalPlace:function e(t,n){if(isNaN(t)||isNaN(n)){TS.warn("Input must be a number.");return t}var i=t.toFixed(n);var r=TS.i18n.locale();var a=_.get(TS.i18n.locales_number_formatting[r],"decimal_symbol",TS.i18n.locales_number_formatting.default.decimal_symbol);return i.replace(".",a)}})})()},4334:function(e,t){(function(){"use strict";TS.registerModule("generic_dialog",{div:null,is_showing:false,current_setting:null,body_template_html:{},Q:[],ladda_go:null,onKeydown:function e(t){var n=TS.generic_dialog.current_setting;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")||n.enter_always_gos)if(n.show_go_button){TS.generic_dialog.go();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc)if("BODY"===TS.utility.getActiveElementProp("NODENAME"))if(n.show_cancel_button)TS.generic_dialog.cancel();else if(n.esc_for_ok)TS.generic_dialog.go()},alert:function e(t,n,i){return new Promise(function(e){TS.generic_dialog.start({title:n||"",body:t,show_cancel_button:false,esc_for_ok:true,fullscreen:false,go_button_text:i,onEnd:e})})},graphics:{error:"oops"},dark:function e(n,i,r){return new Promise(function(e){TS.generic_dialog.start({type:"dark",graphic:r||false,title:i||"",body:n,show_close_button:false,show_cancel_button:true,cancel_button_text:t,fullscreen:false,show_go_button:false,onCancel:e})})},start:function e(t){if(t.fullscreen){TS.ui.fs_modal.start(t);return}if(TS.generic_dialog.is_showing){if(t.unique&&TS.generic_dialog.current_setting.unique==t.unique)TS.info("redundant generic dialog not Qed: "+t.unique);else TS.generic_dialog.Q.push(t);return}TS.generic_dialog.current_setting=_.defaults({},t,i);var n=TS.generic_dialog.current_setting;if("undefined"===typeof t.show_close_button)n.show_close_button=n.show_cancel_button;if(!TS.generic_dialog.div)TS.generic_dialog.build();var r=TS.generic_dialog.div;var a=n.body;if(n.body_template)if(TS.generic_dialog.body_template_html[n.body_template]){a=TS.generic_dialog.body_template_html[n.body_template];if(n.body)TS.warn("both body and body_template were passed on settings, using body_template");if(n.$body)TS.warn("both $body and body_template were passed on settings, using body_template")}else TS.error(n.body_template+" not found in TS.generic_dialog.body_template_html");if(n.dialog_class)r.addClass(n.dialog_class);var o=TS.templates.generic_dialog({title:new Handlebars.SafeString(n.title),body:new Handlebars.SafeString(a),ladda:n.ladda,type:n.type,img:n.graphic});r.empty();r.html(o);if(n.$body)r.find(".modal-body").empty().append(n.$body);if(n.body_cls)r.find(".modal-body").addClass(n.body_cls);r.find(".close").bind("click",function(){if(n.show_cancel_button)TS.generic_dialog.cancel();else if(n.esc_for_ok)TS.generic_dialog.go()});r.find(".dialog_go").click(TS.generic_dialog.go);if(n.ladda)r.find(".dialog_go .ladda-label").html(n.go_button_text);else r.find(".dialog_go").html(n.go_button_text);if(n.show_go_button)r.find(".dialog_go").removeClass("hidden").addClass(n.go_button_class);else r.find(".dialog_go").addClass("hidden");r.find(".dialog_secondary_go").click(TS.generic_dialog.secondaryGo);r.find(".dialog_secondary_go").html(n.secondary_go_button_text);if(n.show_secondary_go_button)r.find(".dialog_secondary_go").removeClass("hidden").addClass(n.secondary_go_button_class);else r.find(".dialog_secondary_go").addClass("hidden");r.find(".dialog_cancel").click(TS.generic_dialog.cancel);r.find(".dialog_cancel").html(n.cancel_button_text);r.find(".dialog_cancel").toggleClass("hidden",!n.show_cancel_button);r.find(".close").toggleClass("hidden",!n.show_close_button);if(n.show_throbber)r.find(".throbber").removeClass("hidden");else r.find(".throbber").addClass("hidden");if(n.title)r.find(".modal-header").removeClass("hidden");else r.find(".modal-header").addClass("hidden");var s=n.show_go_button||n.show_secondary_go_button||n.show_cancel_button;var l=!s||n.hide_footer;r.find(".modal-footer").toggleClass("hidden",!!l);r.modal("show");if(n.backdrop_click_to_dismiss)$(".modal-backdrop").click(function(){TS.generic_dialog.cancel()});if("dark"===n.type)$(".modal-backdrop").addClass("c-modal_backdrop--dark");if(n.title||n.force_small)r.removeClass("small");else r.addClass("small");if(document.activeElement&&document.activeElement!=document.body)document.activeElement.blur();if(n.onShow)n.onShow()},go:function e(){if(!TS.generic_dialog.is_showing){TS.error("not showing?");return}var t=TS.generic_dialog.current_setting;var n=TS.generic_dialog.div;if(t.onGo){if(false!==t.onGo())n.modal("hide")}else n.modal("hide")},secondaryGo:function e(t){if(!TS.generic_dialog.is_showing){TS.error("not showing?");return}var n=TS.generic_dialog.current_setting;var i=TS.generic_dialog.div;if(n.onSecondaryGo){if(false!==n.onSecondaryGo(t))i.modal("hide")}else i.modal("hide")},cancel:function e(){var t=TS.generic_dialog.current_setting;TS.generic_dialog.div.modal("hide");if(t.onCancel)t.onCancel()},end:function e(){var t=TS.generic_dialog.current_setting;TS.model.dialog_is_showing=false;TS.generic_dialog.is_showing=false;$(window.document).unbind("keydown",TS.generic_dialog.onKeydown);if(t.$body)t.$body.detach();TS.generic_dialog.div.empty();if(t.dialog_class)TS.generic_dialog.div.removeClass(t.dialog_class);if(t.onEnd)t.onEnd();TS.generic_dialog.ladda_go=null;if(!TS.generic_dialog.is_showing&&TS.generic_dialog.Q.length){var n=TS.generic_dialog.Q.shift();TS.generic_dialog.start(n)}},build:function e(){var t=TS.generic_dialog.current_setting&&TS.generic_dialog.current_setting.type||"default";var n="onboarding_dialog"===TS.generic_dialog.current_setting.type?"":" fade";$("body").append('<div id="generic_dialog" class="modal c-modal--'+t+n+' hide" data-keyboard="false" data-backdrop="static"></div>');TS.generic_dialog.div=$("#generic_dialog");var i=TS.generic_dialog.div;i.on("hidden",function(e){if(e.target!=this)return;setTimeout(function(){TS.generic_dialog.end();i.removeAttr("data-qa")},200)});i.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.generic_dialog.is_showing=true});i.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){if(!TS.generic_dialog.is_showing)return;i.find(".title_input").select();$(window.document).bind("keydown",TS.generic_dialog.onKeydown);i.attr("data-qa","generic_dialog_ready");if(TS.generic_dialog.current_setting.ladda)TS.generic_dialog.ladda_go=Ladda.create(i.find(".dialog_go")[0])},100)})},startLadda:function e(){if(TS.generic_dialog.ladda_go)TS.generic_dialog.ladda_go.start();TS.generic_dialog.div.find(".dialog_go").addClass("disabled")},stopLadda:function e(){TS.generic_dialog.div.find(".dialog_go").removeClass("disabled");if(TS.generic_dialog.ladda_go)TS.generic_dialog.ladda_go.stop()},showError:function e(t){var n=TS.generic_dialog.div.find(".modal-footer .generic_dialog_error");if(!n.length){n=$('<div class="generic_dialog_error yolk_orange top_margin">');TS.generic_dialog.div.find(".modal-footer").append(n)}n.text(t)},hideError:function e(){TS.generic_dialog.div.find(".modal-footer .generic_dialog_error").remove()}});var e=TS.i18n.t("Cancel","generic_dialog")();var t=TS.i18n.t("Close","generic_dialog")();var n=TS.i18n.t("OK","generic_dialog")();var i={type:"default",graphic:false,title:"",body:"BODY",body_template:null,body_cls:null,$body:null,show_go_button:true,show_secondary_go_button:false,show_cancel_button:true,go_button_text:n,go_button_class:"",secondary_go_button_text:n,secondary_go_button_class:"",cancel_button_text:e,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,show_throbber:false,esc_for_ok:false,onShow:null,force_small:false,enter_always_gos:false,fullscreen:false,dialog_class:null,hide_footer:false,backdrop_click_to_dismiss:false}})()},4335:function(e,t){(function(){"use strict";TS.registerModule("sidebar_themes",{default_themes:{default_theme:{column_bg:"#4D394B",menu_bg:"#3E313C",active_item:"#4C9689",active_item_text:"#FFFFFF",hover_item:"#3E313C",text_color:"#FFFFFF",active_presence:"#38978D",badge:"#EB4D5C"},hoth_theme:{column_bg:"#F8F8FA",menu_bg:"#F8F8FA",active_item:"#CAD1D9",active_item_text:"#FFFFFF",hover_item:"#FFFFFF",text_color:"#383F45",active_presence:"#60D156",badge:"#FF8669"},monument_theme:{column_bg:"#0D7E83",menu_bg:"#076570",active_item:"#F79F66",active_item_text:"#FFFFFF",hover_item:"#D37C71",text_color:"#FFFFFF",active_presence:"#F79F66",badge:"#F15340"},chocolate_theme:{column_bg:"#544538",menu_bg:"#42362B",active_item:"#5DB09D",active_item_text:"#FFFFFF",hover_item:"#4A3C30",text_color:"#FFFFFF",active_presence:"#FFFFFF",badge:"#5DB09D"},ocean_theme:{column_bg:"#303E4D",menu_bg:"#2C3849",active_item:"#6698C8",active_item_text:"#FFFFFF",hover_item:"#4A5664",text_color:"#FFFFFF",active_presence:"#94E864",badge:"#78AF8F"},workhard_theme:{column_bg:"#4D5250",menu_bg:"#444A47",active_item:"#D39B46",active_item_text:"#FFFFFF",hover_item:"#434745",text_color:"#FFFFFF",active_presence:"#99D04A",badge:"#DB6668"},solanum_theme:{column_bg:"#4F2F4C",menu_bg:"#452842",active_item:"#8C5888",active_item_text:"#FFFFFF",hover_item:"#3E313C",text_color:"#FFFFFF",active_presence:"#D0FF00",badge:"#889100"},brinjal_theme:{column_bg:"#4F2F4C",menu_bg:"#452842",active_item:"#8C5888",active_item_text:"#FFFFFF",hover_item:"#3E313C",text_color:"#FFFFFF",active_presence:"#00FFB7",badge:"#DE4C0D"},cotton_theme:{column_bg:"#BB6A76",menu_bg:"#AD5B67",active_item:"#62B791",active_item_text:"#FFFFFF",hover_item:"#A5516A",text_color:"#FFFFFF",active_presence:"#68F798",badge:"#694464"},eco_theme:{column_bg:"#86A34E",menu_bg:"#94AF63",active_item:"#FFFFFF",active_item_text:"#6D8B42",hover_item:"#94AF63",text_color:"#FFFFFF",active_presence:"#FFB10A",badge:"#DFA044"}},onStart:function e(){if(TS.client)TS.client.login_sig.add(TS.sidebar_themes.onLogin,TS.sidebar_themes)},onLogin:function e(){if(TS.model.prefs.sidebar_theme)TS.prefs.sidebar_theme_changed_sig.dispatch()}})})()},4336:function(e,t){(function(){"use strict";TS.registerModule("ui.tabs",{instances:[],onStart:function e(){},create:function t(n,i){if(!n)return false;return new e(n,i)}});function e(e,a){if("undefined"===typeof e)return null;this.element=e;var o=i(e);var s=n(o);this.element.on("click",".tab",function(e){e.preventDefault();return r(this,o,s).bind(this)});this.unbind=function(){this.element.off();this.element=null;o=null;s=null};this.element.one("remove",this.unbind);var l=t(o,a);r(l,o,s);return this}function t(e,t){if(t&&t.default_tab){var n=_.filter(e,function(e){if($(e).attr("href")=="#"+t.default_tab)return true;return false})[0];if(n)return n;TS.warn("Default tab was not found, falling back to first tab.");return e[0]}return e[0]}e.prototype.destroy=function(){this.element.off();this.element.remove()};function n(e){if("undefined"===typeof e)return[];return e.map(function(e,t){return $(t).attr("href")}).map(function(e,t){return $(t)})}function i(e){if("undefined"===typeof e)return[];return e.find(".tab").map(function(e,t){return $(t)})}function r(e,t,n){if("undefined"===typeof e)return false;n.map(function(e,t){return $(t).removeClass("active")});t.map(function(e,t){return $(t).removeClass("active")});var i=$(e);i.addClass("active");var r=$(i.attr("href"));var a=r.addClass("active");i=null;r=null;return a}})()},4337:function(e,t){(function(){"use strict";TS.registerModule("help_modal",{onStart:function e(){TS.help.issues_sorted_sig.add(S)},start:function e(){m()}});var e=false;var t=false;var n;var i;var r;var a;var o;var s;var l;var c;var u;var d=null;var _=null;var f=null;var m=function e(){var t={body_template_html:TS.templates.help_modal(),modal_class:"help_modal fs_modal_footer fs_modal_header",show_cancel_button:false,go_button_text:TS.i18n.t("Contact Us","help")(),onShow:y,onGo:k,onEnd:b,clog_name:"HELP_MODAL"};if(TS.client)TS.ui.a11y.saveCurrentFocus();TS.ui.fs_modal.start(t)};var g=function e(){a=$(TS.templates.help_modal_header()).appendTo(i)};var p=function e(){if(a)a.remove();a=null};var h=function e(){o=$(TS.templates.help_modal_footer()).appendTo(r);s=r.find(".help_modal_status")};var v=function e(){if(o)o.remove();o=null;s=null};var S=function t(){if(!e)return;T()};var T=function e(){var t={unread_count:0,open_count:0,all_count:TS.help.issues.length,is_unread:false,is_unread_many:false,is_open:false,is_open_many:false,is_old_tickets:false};for(var n=0;n<TS.help.issues.length;n+=1){var i=TS.help.issues[n];if("unread"===i.state)t.unread_count+=1;else if("open"===i.state)t.open_count+=1}t.is_unread=0!=t.unread_count;t.is_unread_many=t.unread_count>1;t.is_open=0!=t.open_count&&0==t.unread_count;t.is_open_many=t.open_count>1;t.is_old_tickets=t.all_count&&0==t.is_unread&&0==t.is_open;s.html(TS.templates.help_modal_footer_status({settings:t}))};var y=function t(){e=true;i=$("#fs_modal");r=$("#fs_modal_footer");n=$("#help_modal_container");u=n.find("#browse_all");c=n.find("#help_modal_filter");l=n.find("#help_modal_list_container");g();h();T();w();TS.api.call("helpdesk.get",{locale:TS.i18n.locale().toLowerCase()},M)};var b=function d(){e=false;t=false;n=null;i=null;r=null;a=null;o=null;s=null;l=null;c=null;u=null;_=null;f=null;TS.kb_nav.end();p();v();if(TS.client)TS.ui.a11y.restorePreviousFocus()};var w=function r(){i.find(".keyboard_shortcuts").on("click",function(e){e.preventDefault();TS.ui.fs_modal.close(true);TS.ui.shortcuts_dialog.start()});c.on("textchange",function(){if(!e||!t)return;x()}).on("keydown",function(e){if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()});n.on("click",".clear_filter_icon",function(){c.val("").trigger("textchange").focus()});l.on("click",".help_modal_article_row",function(e){L($(this),e)});u.on("click",function(e){e.preventDefault();var t=E();if(t){window.open(t);TS.clog.track("HELP_MODAL_SEARCH",{search_terms:t})}else window.open($(this).attr("href"))})};var k=function t(){if(!e){TS.error("not showing?");return}TS.utility.openAuthenticatedInBrowser("/help/requests/new");TS.ui.fs_modal.close(true);TS.clog.track("HELP_MODAL_ACTION",{action:"submit_new_request",trigger:"click_submit_new_request"})};var x=function e(){var t=E();if(t){c.parent().addClass("active");_=F(d,t)}else{c.parent().removeClass("active");_=C(f)}if(t&&_.length<7)_=R(_,t);l.longListView("setItems",_);l.scrollTop(0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(l)});if(t)TS.kb_nav.highlightFirstItem();else TS.kb_nav.clearHighlightedItem()};var E=function e(){return $.trim(c.val())};var M=function e(t,n){if(!t){TS.error("failed to fetch help articles");return}d=JSON.parse(n.articles).articles;_=d;f=A(d);l.empty();I();x();c.focus()};var C=function e(t){var n=[];if(t.length>0){n.push({is_divider:true,title:TS.i18n.t("Popular help topics","help")()});n=n.concat(t)}return n};var R=function e(t,n){t.push({is_divider:false,title:TS.i18n.t('Search for "{query}" on the Help Center',"help")({query:n}),url:O(n)});return t};var F=function e(t,n){n=TS.utility.regexpEscape(n);var i=new RegExp(n,"i");var r=-1;var a=t.filter(function(e,t){if(e.title.toLowerCase()===n.toLowerCase()){r=t;return false}return e.title.match(i)});if(-1!==r)a.unshift(t[r]);return a};var I=function e(){l.longListView({items:_,approx_item_height:40,approx_divider_height:35,preserve_dom_order:true,makeElement:function e(t){var n=$(TS.templates.help_modal_article_row());t.$title=n.find(".article_title");return n},makeDivider:function e(){return $("<div>").addClass("help_modal_divider")},renderItem:function e(t,n,i){i.$title.text(n.title);t.data("url",n.url)},renderDivider:function e(t,n){t.text(n.title)},calcItemHeight:function e(t){return t.outerHeight()}});l.monkeyScroll();t=true;TS.kb_nav.start(l.find(".list_items"),".help_modal_article_row",l,{use_data_ordering:true,px_offset:0,scrollToStartImmediately:function e(){l.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){l.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){L($(this),e)})};var A=function e(t){var n=[];for(var i=0;i<t.length;i+=1)if(t[i].popular)n.push(t[i]);n.sort(function(e,t){if(void 0==e.order)return 1;else if(void 0==t.order)return-1;return e.order-t.order});return n};var L=function e(t){var n=t.data("url");var i=E();if(n){window.open(n);if(-1==n.indexOf("hc/search?"))TS.clog.track("HELP_MODAL_ZD_HIT",{zd_article_url:n});if(i)TS.clog.track("HELP_MODAL_SEARCH",{search_terms:i,locale:TS.i18n.locale()})}};var O=function e(t){return"https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/search?utf8=✓&commit=Search&query="+t}})()},4338:function(e,t){(function(){"use strict";TS.registerModule("ui.comments",{editing_file:null,editing_comment:null,editing:false,$edit_form:null,bound:false,onStart:function e(){TS.ui.comments.$edit_form=$("#file_edit_comment_form");if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())TS.ui.comments.bindInput($("#file_comment"));else{var t=$("#file_comment");t.one("focus.uicomments",function(){TS.ui.comments.bindInput(t)})}TS.ui.comments.bindButton($("#file_comment_submit_btn"))},bindButton:function e(t){t.bind("keydown.cmd_submit",function(e){if(e.which===TS.utility.keymap.enter&&t.is(":focus"))t.closest("form").submit()})},bindInput:function e(t,n){if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()&&TS.tabcomplete){TS.utility.contenteditable.create(t,{modules:{tabcomplete:{searchOptions:{complete_member_specials:false},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members],positionMenu:function e(n){if(TS.web&&TS.web.space)n.style.width=Math.min(t.outerWidth(),474)+"px";else n.style.width=Math.min(t.outerWidth(),360)+"px";TS.tabcomplete.positionUIRelativeToInput(n,t)},no_model_ob:!TS.client}},onEnter:function e(){if(n)n();else t.closest("form").submit();return false},onTextChange:function e(){if(!TS.client)return;if(TS.ui.fs_modal_file_viewer.is_showing&&$("#file_comment").closest("#fs_modal").length)TS.ui.fs_modal_file_viewer.storeLastCommentInput();else{TS.client.ui.files.storeLastCommentInputForPreviewedFile(TS.utility.contenteditable.value(t));TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))}},onEscape:function e(){if(TS.client&&TS.ui.fs_modal_file_viewer.is_showing&&TS.ui.fs_modal_file_viewer.canClose())TS.ui.fs_modal.close()}});TS.utility.contenteditable.enable(t);t.on("keyup",function(){var e=TS.utility.contenteditable.cursorPosition(t);if(!e.length){var n=t.closest("form");var i=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||n.outerHeight()<i.height)n.find("button[type=submit]").scrollintoview({px_offset:-50,complete:function e(){TS.tabcomplete.positionUIRelativeToInput($(".tab_complete_ui")[0],t)}})}})}else{t.TS_tabComplete({complete_cmds:false,complete_channels:true,complete_emoji:true,complete_member_specials:false,complete_user_groups:true,onComplete:function e(n,i){TS.utility.populateInput(t,n,i)},include_self:!!TS.boot_data.feature_name_tagging_client});t.bind("keydown.cmd_submit",function(e){if(e.which===TS.utility.keymap.enter){if(t.tab_complete_ui("isShowing")){e.preventDefault();return}if(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(t)){if(e.shiftKey){$(this).closest("form").submit();e.preventDefault()}return}if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(n)n();else $(this).closest("form").submit();e.preventDefault()}}});t.tab_complete_ui({id:"comment_input_tab_ui",min_width:300,narrow:!!TS.client,no_model_ob:true,scroll_with_element:!!TS.client})}},unbindInput:function e(t){if(!t)return;if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty()){t.unbind("keydown.cmd_submit");t.removeData()}},bindEditForm:function e(){TS.ui.comments.bound=true;var t=TS.ui.comments.$edit_form;$("#file_edit_comment").css("overflow","hidden").autogrow();TS.ui.comments.bindInput($("#file_edit_comment"));t.unbind("submit").bind("submit",TS.ui.comments.submitEditForm);t.find(".save").unbind("click").bind("click",function(){TS.ui.comments.submitEditForm();return false});t.find(".cancel").unbind("click").bind("click",function(){TS.ui.comments.onEndEdit();return false});t.unbind("destroyed").bind("destroyed",function(){$("#file_comment_form").after($(this)[0].outerHTML);TS.ui.comments.$edit_form=$("#file_edit_comment_form");TS.ui.comments.bound=false;if(!TS.ui.comments.editing)return;TS.ui.comments.onEndEdit()})},submitEditForm:function e(){if(TS.utility.contenteditable.isEmpty($("#file_edit_comment"),true)){if(TS.client)TS.sounds.play("beep");return false}TS.ui.comments.saveEdit();return false},startEdit:function e(t,n,i){if(TS.ui.comments.editing)TS.ui.comments.onEndEdit();var r=TS.files.getFileById(t);if(!r){TS.error("no file?");return null}var a=TS.files.getFileCommentById(r,n);if(!a){TS.error("no comment?");return null}var o=TS.ui.comments.$edit_form;var s;if(!i)s=$("#"+a.id);else s=i.closest(".comment");if(!s.length){TS.error("no #"+a.id+"?");return}s.addClass("comment_editing").append(o);TS.utility.contenteditable.clear($("#file_edit_comment"));$("#file_edit_comment").css("height","");if(!TS.ui.comments.bound)TS.ui.comments.bindEditForm();o.removeClass("hidden");TS.utility.contenteditable.clearHistory($("#file_edit_comment"));TS.utility.contenteditable.value($("#file_edit_comment"),TS.format.unFormatMsg(a.comment));TS.utility.contenteditable.focus($("#file_edit_comment"));TS.utility.contenteditable.cursorPosition($("#file_edit_comment"),1e6);if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_edit_comment").trigger("keyup");$("#file_comment_form").css("visibility","hidden");TS.ui.comments.editing=true;TS.ui.comments.editing_file=r;TS.ui.comments.editing_comment=a},saveEdit:function e(){var t=TS.ui.comments.editing_file;var n=TS.ui.comments.editing_comment;var i=$('.comment[data-comment-id="'+n.id+'"] .comment_body');var r=TS.format.cleanMsg(TS.utility.contenteditable.value($("#file_edit_comment")));if(r!=n.comment){var a=n.comment;n.comment=r;if(i.length)i.html(TS.format.formatJustText(n.comment));TS.api.call("files.comments.edit",{file:t.id,id:n.id,comment:r},function(e){if(!e){n.comment=a;if(i.length)i.html(TS.format.formatJustText(n.comment));TS.generic_dialog.alert(TS.i18n.t("Something’s gone wrong, and your change didn’t save. If you see this message more than once, you may want to try restarting Slack.","comments")(),TS.i18n.t("Oh, crumbs!","comments")(),TS.i18n.t("Got it","comments")())}})}TS.ui.comments.onEndEdit()},onEndEdit:function e(){var t=TS.ui.comments.editing_comment;if(!t)return;TS.ui.comments.$edit_form.addClass("hidden");$('[data-comment-id="'+t.id+'"].comment_editing').removeClass("comment_editing");$("#file_comment_form").css("visibility","");TS.ui.comments.editing=false;TS.ui.comments.editing_file=null;TS.ui.comments.editing_comment=null},startDelete:function e(t,n){var i=TS.files.getFileById(t);if(!i){TS.error("no file?");return null}var r=TS.files.getFileCommentById(i,n);if(!r){TS.error("no comment?");return null}TS.generic_dialog.start({title:TS.i18n.t("Delete a file comment","comments")(),body:TS.i18n.t("<p>Are you sure you want to delete this comment? This cannot be undone.</p>","comments")()+TS.templates.builders.buildCommentHTML({comment:r,file:i,show_comment_actions:false,hide_star:true}),go_button_text:TS.i18n.t("Yes, delete the comment","comments")(),go_button_class:"btn_danger",onGo:function e(){TS.ui.comments.commitDelete(t,n)}})},commitDelete:function e(t,n){var i=TS.files.getFileById(t);if(!i){TS.error("no file?");return null}var r=TS.files.getFileCommentById(i,n);if(!r){TS.error("no comment?");return null}TS.api.call("files.comments.delete",{file:t,id:n},function(e,t){if(e)if(TS.client);else TS.files.deleteCommentOnFile(r.id,i);else if("comment_not_found"===t.error)TS.files.deleteCommentOnFile(r.id,i)})},removeFileComment:function e(t,n,i){$('.comment[data-comment-id="'+n+'"]').slideUp(200,function(){var e=this.parentNode;$(this).remove();if(e.innerHTML.match(/^[\s\r\n]*$/))$(e).empty();if("function"===typeof i)i.apply(this,arguments)})}})})()},4339:function(e,t){(function(){"use strict";TS.registerModule("ds.msg_handlers",{onStart:function t(){TS.ds.on_msg_sig.add(e)},hello:function e(t){TS.model.members.forEach(function(e){e.ds_active=false});if(!t.active||!t.active.length)return;var n;for(var i=0;i<t.active.length;i+=1){n=TS.members.getMemberById(t.active[i]);if(!n){TS.error('unknown member: "'+t.active[i]+'"');return}n.ds_active=true}},presence_change:function e(t){var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}if("away"!==t.presence&&"active"!==t.presence){TS.error('unknown presence: "'+t.presence+'"');return}if(n.ds_active&&"active"===t.presence)return;if(!n.ds_active&&"away"===t.presence)return;n.ds_active="active"===t.presence;TS.members.ds_presence_changed_sig.dispatch(n)}});var e=function e(t){if(t.reply_to)return;if("rocket"===t.event)return;if(!TS.ds.msg_handlers[t.type]){TS.error("non handled non rocket event received\n"+JSON.stringify(t,null,"  "));return}TS.ds.msg_handlers[t.type](t)}})()},4340:function(e,t){(function(){"use strict";TS.registerModule("inline_audios",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,n){if(TS.model.expandable_state["aud_"+t+_.escape(n.src)])return true;if(false===TS.model.expandable_state["aud_"+t+_.escape(n.src)])return false;if(n.internal_file_id)return TS.model.prefs.expand_internal_inline_imgs;return TS.model.prefs.expand_inline_imgs},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=audio]:not(.expanded)");if(!t.length)return;TS.inline_audios.no_scrolling=true;t.trigger("click");TS.inline_audios.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=audio].expanded").trigger("click")},expand:function e(t,n){TS.model.expandable_state["aud_"+t+_.escape(n)]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(t);var r=$(i);if(!r.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=function e(){return $(this).data("real-src")==n};var s=TS.boot_data.feature_attachments_inline?r.find(".inline_attachment").filter(o):null;if(!s||!s.length)s=r.find(".msg_inline_audio_holder").filter(o);s.removeClass("hidden");r.find(".msg_inline_media_toggler[data-media-type=audio]:not(.expanded)").filter(o).addClass("expanded");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();s.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_audios.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);r.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else r.find(".msg_inline_audio").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_audios.expand_sig.dispatch(t);if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,n){TS.model.expandable_state["aud_"+t+_.escape(n)]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(t);var r=$(i);if(!r.length)return;var a=function e(){return $(this).data("real-src")==n};var o=TS.boot_data.feature_attachments_inline?r.find(".inline_attachment").filter(a):null;if(!o||!o.length)o=r.find(".msg_inline_audio_holder").filter(a);o.css("visibility","hidden");r.find(".msg_inline_media_toggler[data-media-type=audio].expanded").filter(a).removeClass("expanded");o.find(".msg_inline_audio_iframe_div").html("");TS.inline_audios.collapse_sig.dispatch(t);setTimeout(function(){o.addClass("hidden");o.css("visibility","visible")},200)},checkForInlineAudioClick:function e(t){if(!t.target)return;var n=$(t.target);var i;var r=n.closest(".message");i=r.attr("id");if(!i)return;var a=n.closest(".msg_inline_media_toggler[data-media-type=audio]");if(a.length){t.preventDefault();var o=a.data("real-src");if(a.hasClass("expanded"))TS.inline_audios.collapse(i,o);else TS.inline_audios.expand(i,o);return}var s=n.closest(".inline_audio_play_link");if(s.length)t.preventDefault()},makeInternalInlineAudio:function e(t,n){if(!n.audio_html)return;n.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(n.audio_html);TS.model.inline_audios[t]={src:_.escape(n.audio_url||n.audio_html),attachment:n}}})})()},4341:function(e,t){(function(){"use strict";TS.registerModule("privacy_policy_dialog",{div:null,is_showing:false,default_setting:{title:"",body:"BODY",body_template:null,onGo:null,onCancel:null,onEnd:null,esc_for_ok:false,onShow:null,force_small:false,enter_always_gos:false},current_setting:null,body_template_html:{},Q:[],start:function e(t){if(TS.privacy_policy_dialog.is_showing){if(t.unique&&TS.privacy_policy_dialog.current_setting.unique==t.unique)TS.info("redundant generic dialog not Qed: "+t.unique);else TS.privacy_policy_dialog.Q.push(t);return}TS.privacy_policy_dialog.current_setting=_.defaults({},t,TS.privacy_policy_dialog.default_setting);var n=TS.privacy_policy_dialog.current_setting;if(!TS.privacy_policy_dialog.div)TS.privacy_policy_dialog.build();var i=TS.privacy_policy_dialog.div;var r=TS.templates.privacy_policy_dialog({title:n.title,body:n.body,footer:n.footer});i.empty();i.html(r);i.find(".close").bind("click",function(){if(n.show_cancel_button)TS.privacy_policy_dialog.cancel();else if(n.esc_for_ok)TS.privacy_policy_dialog.go()});i.find(".dialog_go").click(TS.privacy_policy_dialog.go);if(n.go_button_text)i.find(".dialog_go").html(n.go_button_text);if(n.show_go_button)i.find(".dialog_go").removeClass("hidden").addClass(n.go_button_class);i.css("opacity",0);i.css("display","block");window.setTimeout(function(){i.css("marginLeft","0px");i.slideDown(function(){i.animate({opacity:1},{duration:500,complete:function e(){i.addClass("fading-in");i.modal({backdrop:false}).show();if(document.activeElement&&document.activeElement!=document.body)document.activeElement.blur();if(n.onShow)n.onShow()}})})},1)},go:function e(t){if(!TS.privacy_policy_dialog.is_showing){TS.error("not showing?");return}var n=TS.privacy_policy_dialog.current_setting;var i=TS.privacy_policy_dialog.div;function r(){i.removeClass("fading-in");i.fadeOut(750,function(){i.modal("hide")})}if(n.onGo){if(false!==n.onGo(t))r()}else r()},cancel:function e(){var t=TS.privacy_policy_dialog.current_setting;var n=TS.privacy_policy_dialog.div;n.removeClass("fading-in");n.fadeOut(750,function(){n.modal("hide")});if(t.onCancel)t.onCancel()},end:function e(){var t=TS.privacy_policy_dialog.current_setting;TS.model.dialog_is_showing=false;TS.privacy_policy_dialog.is_showing=false;TS.privacy_policy_dialog.div.empty();if(t.onEnd)t.onEnd();if(!TS.privacy_policy_dialog.is_showing&&TS.privacy_policy_dialog.Q.length){var n=TS.privacy_policy_dialog.Q.shift();TS.privacy_policy_dialog.start(n)}},build:function e(){$("body").append('<div id="privacy_policy_dialog" class="modal" data-keyboard="false"></div>');TS.privacy_policy_dialog.div=$("#privacy_policy_dialog");var t=TS.privacy_policy_dialog.div;t.on("hidden",function(e){if(e.target!=this)return;setTimeout(function(){TS.privacy_policy_dialog.end()},200)});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.privacy_policy_dialog.is_showing=true})}})})()},4342:function(e,t){(function(){"use strict";TS.registerModule("clipboard",{canWriteText:function t(){return e._canWriteText()},writeText:function t(n){e._writeText(n)},canWriteHTML:function t(){return e._canWriteHTML()},writeHTML:function t(n){e._writeHTML(n)},writeTextFromEvent:function e(t,n){if(!t)return;var i;var r=[];var a=_.keys(n);if(!a.length)return;TS.info("TS.clipboard.writeTextFromEvent: copying to ["+a+"]");try{t=t.originalEvent||t;var o=t.clipboardData||window.clipboardData;_.each(n,function(e,t){try{o.setData(t,e);var n=o.getData(t)||"";if(e===n)r.push(t);TS.info("TS.clipboard.writeTextFromEvent: copied "+n.length+' chars to "'+t+'"')}catch(e){TS.warn('TS.clipboard.writeTextFromEvent: error copying to "'+t+'" ('+e+")")}})}catch(e){i=e}if(!i&&!r.length)i="failed to write to clipboard";if(!i){t.preventDefault();if("cut"===t.type&&TS.utility.isFocusOnInput())if(TS.utility.contenteditable.supportsTexty())TS.utility.contenteditable.deleteSelection(document.activeElement);else window.getSelection().deleteFromDocument()}else TS.error("TS.clipboard.writeTextFromEvent: "+i);TS.clog.track("CLIPBOARD_WRITE",{action:t.type,err:i,types:r.join(",")})},test:function e(){return{detectImplementation:n}}});var e;var t=false;var n=function t(){if(a._canWriteText())e=a;else{i();e=r}};var i=function e(){t=false;if(bowser){if(bowser.chrome&&bowser.version>=42)t=true;if(bowser.firefox&&bowser.version>=41)t=true;if(bowser.msie&&bowser.version>=9)t=true;if(bowser.opera&&bowser.version>=29)t=true}$(window).one("click.check_clipboard_support",function(){t=document.queryCommandSupported("copy")})};var r={_canWriteText:function e(){return t},_writeText:function e(t){var n=document.createElement("textarea");n.appendChild(document.createTextNode(t));document.body.appendChild(n);this._writeNode(n);document.body.removeChild(n)},_canWriteHTML:function e(){return t},_writeHTML:function e(t){var n=$("<p>").html(t);$("body").append(n);this._writeNode(n);n.remove()},_writeNode:function e(t){try{this._saveSelection();t.select();document.execCommand("copy")}catch(e){TS.warn("Something bad happened when we tried to copy: "+e)}finally{this._restoreSelection()}},_saveSelection:function e(){this._current_ranges=[];this._sel=window.getSelection();for(var t=0;t<this._sel.rangeCount;t+=1)this._current_ranges.push(this._sel.getRangeAt(t))},_restoreSelection:function e(){var t=this;this._sel.removeAllRanges();this._current_ranges.forEach(function(e){t._sel.addRange(e)})}};var a={_canWriteText:function e(){return window.TSSSB&&TSSSB.call("canClipboardWriteString")},_writeText:function e(t){TSSSB.call("clipboardWriteString",t)},_canWriteHTML:function e(){return false},_writeHTML:function e(){return TS.warn("We cannot write HTML in SSB")}};n()})()},4343:function(e,t){(function(){"use strict";TS.registerModule("inline_imgs",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,n,i){if(!n||!n.src)return false;if(TS.model.expandable_state["img_"+t+n.src])return true;if(false===TS.model.expandable_state["img_"+t+n.src])return false;if(true===n.should_expand)return true;if(!n.internal_file_id){if(TS.model.prefs.obey_inline_img_limit&&n.bytes>TS.model.inline_img_byte_limit)return false;if(n.width&&n.height)if(n.width*n.height>TS.model.inline_img_pixel_limit)return false}if(n.internal_file_id){var r=TS.inline_file_previews.expandableState(t,n.internal_file_id);if("boolean"===typeof r)return r;return TS.model.prefs.expand_internal_inline_imgs}if(i&&i.is_giphy_shuffle&&!TS.model.prefs.expand_inline_imgs){var a=_.pickBy(TS.model.expandable_state,function(e,n){return _.startsWith(n,"img_"+t)});if(a)return _.values(a)[0]}return TS.model.prefs.expand_inline_imgs},expandAllInCurrent:function e(){TS.inline_imgs.no_scrolling=true;$(".msg_inline_img_expander").trigger("click");$(".msg_inline_img_toggler.collapsed").trigger("click");TS.inline_imgs.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_img_collapser").trigger("click");$(".msg_inline_img_toggler.expanded").trigger("click")},expand:function e(t,n){TS.model.expandable_state["img_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(t);var r=$(i);if(!r.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=function e(){return $(this).data("real-src")==n};var s=TS.boot_data.feature_attachments_inline?r.find(".inline_attachment").filter(o):null;if(!s||!s.length)s=r.find(".msg_inline_img_holder").filter(o);s.removeClass("hidden");r.find(".msg_inline_img_expander").filter(o).addClass("hidden");r.find(".msg_inline_img_collapser").filter(o).removeClass("hidden");r.find(".msg_inline_img_toggler").removeClass("collapsed").addClass("expanded");r.find(".too_large_for_auto_expand").addClass("hidden");r.find(".inline_img_bytes").removeClass("hidden");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();s.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_imgs.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);s.scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else s.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_imgs.expand_sig.dispatch(t);if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,n){TS.model.expandable_state["img_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(t);var r=$(i);if(!r.length)return;var a=function e(){return $(this).data("real-src")==n};var o=TS.boot_data.feature_attachments_inline?r.find(".inline_attachment").filter(a):null;if(!o||!o.length)o=r.find(".msg_inline_img_holder").filter(a);r.find(".msg_inline_img_expander").filter(a).removeClass("hidden");r.find(".msg_inline_img_collapser").filter(a).addClass("hidden");r.find(".msg_inline_img_toggler").removeClass("expanded").addClass("collapsed");TS.inline_imgs.collapse_sig.dispatch(t);o.addClass("hidden")},checkForInlineImgClick:function e(t,n){if(!t.target)return;var i=$(t.target);var r=i.closest(".message");var a=r.attr("id");if(n)a=TS.templates.makeMSRDomId(n);if(!a)return;var o=i.closest(".too_large_but_expand_anyway");if(o.length){t.preventDefault();TS.inline_imgs.expand(a,o.data("real-src"))}var s=i.closest(".msg_inline_img_toggler");if(s.length){t.preventDefault();var l=s.next("*[data-real-src]").data("real-src");if(TS.inline_imgs.shouldExpand(a,TS.model.inline_imgs[l]))TS.inline_imgs.collapse(a,l);else TS.inline_imgs.expand(a,l);return}var c=i.closest(".msg_inline_img_expander");if(c.length){t.preventDefault();TS.inline_imgs.expand(a,c.data("real-src"))}var u=i.closest(".msg_inline_img_collapser");if(u.length){t.preventDefault();TS.inline_imgs.collapse(a,u.data("real-src"))}},makeInternalInlineImg:function e(t,n){var i=400;var r=500;if(TS.model.inline_imgs[t]){n.internal_file_id=TS.model.inline_imgs[t].internal_file_id||n.internal_file_id;n.link_url=TS.model.inline_imgs[t].link_url||n.link_url;n.src=TS.model.inline_imgs[t].src||n.src}TS.model.inline_imgs[t]=n;n.src=n.src||t;n.bytes=parseInt(n.bytes,10);var a={};if(n.rotation){a.rotate=true;if(90==Math.abs(parseInt(n.rotation,10))){var o=n.height;n.height=n.width;n.width=o}}n.display_w=parseInt(n.width,10);n.width=n.display_w;n.display_h=parseInt(n.height,10);n.height=n.display_h;if(n.display_w>i){n.display_w=i;n.display_h=parseInt(n.height*(n.display_w/n.width),10);a.resize=true}if(n.display_h>r){n.display_h=r;n.display_w=parseInt(n.width*(n.display_h/n.height),10);a.resize=true}a.width=n.display_w;a.height=n.display_h;if("image/svg+xml"===n.content_type)a.render_svg=true;var s=TS.utility.getImgProxyURLWithOptions(n.src,a);if(s!=n.src)n.proxied_src=s;else delete n.proxied_src}})})()},4344:function(e,t){(function(){"use strict";TS.registerModule("kb_nav",{onStart:function e(){},is_paused:false,start:function e(i,a,o,s){n=i;r=a;f.lastX=null;f.lastY=null;if(!o)o="#menu";t=$(o);l=s&&!!s.use_data_ordering;c={allowTabHighlightWhenEmptyInput:TS.boot_data.feature_keyboard_navigation,bindTo:document};u=_.assign(c,s);$(document).on("mousemove.keyboard_navigation",m);$(u.bindTo).on("keydown",TS.kb_nav.onKeyDown);n.on("mouseenter.keyboard_navigation",r,T)},pause:function e(t){TS.kb_nav.is_paused=t},end:function e(){S();g();if(n)n.off(".keyboard_navigation");$(document).off("mousemove.keyboard_navigation",m);$(u.bindTo).off("keydown",TS.kb_nav.onKeyDown);n=null;r=null;a=null;o=false;s=null;l=false;u=c},getHighlightedItem:function e(){return a},getItemByItemId:function e(t){var i=n.children(r).filter(":not(.disabled):visible");var a=$.makeArray(i);for(var o=0,s;o<a.length;o+=1){s=$(a[o]);if(t===s.data("item-id"))return s}},clearHighlightedItem:function e(){S()},highlightFirstItem:function e(){var t=w();if(t&&t.length>0){d();v(t)}else S()},highlightItemWithKey:function e(t,n){v(t,n)},setAllowHighlightWithoutBlurringInput:function e(t){o=t},setSubmitItemHandler:function e(t){s=t},onKeyDown:function e(t){if(TS.kb_nav.is_paused)return;if(TS.ui.react_emoji_menu.is_showing)return;var n=TS.utility.keymap;var i=t.which;var r=t.metaKey||t.ctrlKey||t.shiftKey||t.altKey;if(i==n.up&&(o&&!r||!b(t.target))){t.stopPropagation();t.preventDefault();d();p(t);return}if(i==n.down&&(o&&!r||!b(t.target))){t.stopPropagation();t.preventDefault();d();h(t);return}if(i==n.left&&!b(t.target)){t.stopPropagation();t.preventDefault();d();if(u&&u.onLeftKeyDownIfSubmenuExists&&u.onLeftKeyDownIfSubmenuExists(t))return;p(t);return}if(i==n.right&&!b(t.target)){t.stopPropagation();t.preventDefault();d();if(u&&u.onRightKeyDownIfSubmenuExists&&u.onRightKeyDownIfSubmenuExists(t))return;h(t);return}if(i==n.tab){if(!u.allowTabHighlightWhenEmptyInput&&b(t.target)&&0===$(t.target).val().length)return;t.stopPropagation();t.preventDefault();d();if(!o&&b(t.target))$(t.target).blur();if(t.shiftKey)p(t);else h(t);return}if(i==n.enter&&a){if(s){var l=a.get(0);if(l)s.call(l,t);else s(t);return}t.stopPropagation();t.preventDefault();y()}}});var e={keyboard_active:"keyboard_active",no_pointer_events:"no_pointer_events"};var t=null;var n=null;var i=false;var r=null;var a=null;var o=false;var s=null;var l=false;var c={};var u=c;var d=function n(){if(i)return;t.addClass(e.keyboard_active);t.addClass(e.no_pointer_events);i=true};var f={lastX:null,lastY:null};var m=function e(t){if(!i){f.lastX=t.clientX;f.lastY=t.clientY;return}if(null===f.lastX){f.lastX=t.clientX;f.lastY=t.clientY}else{if(t.clientX!==f.lastX||t.clientY!==f.lastY)g();f.lastX=t.clientX;f.lastY=t.clientY}};var g=function n(){if(!i)return;S();t.removeClass(e.keyboard_active);t.removeClass(e.no_pointer_events);i=false};var p=function e(t){var i;var o=r;if(a)i=E(a);else i=k();if(i&&i.length>0){v(i);if(u&&u.onMoveHighlight)u.onMoveHighlight()}else if(0!==n.children(o).filter(":not(.disabled):visible").length){S();e(t)}};var h=function e(t){var i;var o=r;if(a)i=x(a);else i=w();if(i&&i.length>0){v(i);if(u&&u.onMoveHighlight)u.onMoveHighlight()}else if(0!==n.children(o).filter(":not(.disabled):visible").length){S();e(t)}};var v=function e(t,n){S();a=t;var i=0;if(u&&u.px_offset)i=u.px_offset;t.addClass("highlighted");if(!n)t.scrollintoview({offset:"top",px_offset:i,duration:0});if(!u||!u.no_blur)t.find("a:first").focus();a.trigger("highlighted")};var S=function e(){if(a){a.trigger("unhighlighted");a.removeClass("highlighted");a=null}};var T=function e(t){S();a=$(t.target).closest(r);a.trigger("highlighted")};var y=function e(){if(a)a.find("a:first").click()};var b=function e(t){return $(t).is("input, textarea")||TS.utility.contenteditable.isContenteditable(t)};var w=function e(){if(l){if(u.scrollToStartImmediately)u.scrollToStartImmediately();var t=M();if(0===t.length)return null;return $(t[0])}return n.children(r).filter(":not(.disabled):visible:first")};var k=function e(){if(l){if(u.scrollToEndImmediately)u.scrollToEndImmediately();var t=M();if(0===t.length)return null;return $(t[t.length-1])}return n.children(r).filter(":not(.disabled):visible:last")};var x=function e(t){if(l){var i=M();var a=t.data("order-index");for(var o=0;o<i.length;o+=1)if($(i[o]).data("order-index")==a){if(o+1<i.length)return $(i[o+1]);break}return null}var s=n.children(r).filter(":not(.disabled):visible");var c=s.index(t);return s.eq(c+1)};var E=function e(t){if(l){var i=M();var a=t.data("order-index");for(var o=0;o<i.length;o+=1)if($(i[o]).data("order-index")==a){if(o-1>=0)return $(i[o-1]);break}return null}var s=n.children(r).filter(":not(.disabled):visible");var c=s.index(t);return s.eq(c-1)};var M=function e(){var t=n.children(r).filter(":not(.disabled):visible");var i=$.makeArray(t);i.sort(function(e,t){var n=$(e).data("order-index");var i=$(t).data("order-index");return n-i});return i}})()},4345:function(e,t){(function(){"use strict";TS.registerModule("sounds",{onStart:function n(){var i=TS.boot_data.abs_root_url;var r=[].concat(TS.boot_data.notification_sounds||[]).concat(TS.boot_data.alert_sounds||[]).concat(TS.boot_data.call_sounds||[]);var a=[];if(TS.has_pri[t])TS.log(t,"adding all_sounds: "+r.length);r.forEach(function(n){if(!n.url)return;if(0!==n.url.indexOf("http"))n.url=i+n.url.replace("/","");if(n.url_ogg&&0!==n.url_ogg.indexOf("http"))n.url_ogg=i+n.url_ogg.replace("/","");if(TS.has_pri[t])TS.log(t,"adding sound: "+n.value);e[n.value]={url:n.url,url_ogg:n.url_ogg};if(TS.has_pri[t])TS.log(t,"_sounds["+n.value+"] = "+e[n.value]);a.push(n.url)});if(window.Audio)soundManager.onready(function(){$.each(e,function(t,n){if(n.url_ogg)n.url=[n.url,n.url_ogg];e[t]=soundManager.createSound(n)})});try{if(TSSSB.call("preloadSounds",a)){if(TS.has_pri[t])TS.log(t,"called TSSSB.call('preloadSounds', '"+a+"')")}else if(TS.has_pri[t])TS.log(t,"NOT CALLED TSSSB.call('preloadSounds', '"+a+"')")}catch(e){TS.warn("error calling TSSSB.preloadSounds "+e+" "+a)}},shouldMuteSounds:function e(t){t=t||{};t.ignore_mute=t.ignore_mute||false;var n=TS.model&&TS.model.prefs&&TS.model.prefs.mute_sounds;n=n||TSSSB.call("shouldMuteAudio");n=n&&!t.ignore_mute;return n},filenameForSoundName:function t(n,i){if("new_message"===n)n=TS.model.prefs.new_msg_snd;if("none"===n)return;if("beep"===n)n="frog.mp3";if(!(n in e)){TS.warn("unknown sound: "+n);return}if(TS.sounds.shouldMuteSounds(i))return;return n},soundForName:function t(n,i){n=TS.sounds.filenameForSoundName(n,i);if(!n)return;if(TS.sounds.shouldMuteSounds(i))return;return e[n]},play:function e(n,i){i=i||{};i.should_loop=i.should_loop||false;i.ignore_mute=i.ignore_mute||false;var r=TS.sounds.soundForName(n,i);if(r){var a={url:r.url,should_loop:i.should_loop};if(TSSSB.call("playRemoteSound",a)){if(TS.has_pri[t])TS.log(t,"called TSSSB.call('playRemoteSound', '"+JSON.stringify(a)+"'})")}else if(_.isFunction(r.play)){if(TS.has_pri[t])TS.log(t,"calling sound.play()");r.play({loops:i.should_loop?999999:0})}else if(TS.has_pri[t])TS.log(t,"wanted to call sound.play() but it is not a function")}else if(soundManager)TS.warn("sound is null: "+n+" window.Audio: "+window.Audio+" window.winssb: "+window.winssb+" soundManager.ok(): "+soundManager.ok()+" soundManager.html5Only: "+soundManager.html5Only+" soundManager.canPlayMIME('audio/mp3'): "+soundManager.canPlayMIME("audio/mp3"))},stop:function e(n,i){i=i||{};i.ignore_mute=i.ignore_mute||false;var r=TS.sounds.soundForName(n,i);if(r)if(TSSSB.call("stopRemoteSound",r.url)){if(TS.has_pri[t])TS.log(t,"called TSSSB.call('stopRemoteSound', '"+r.url+"')")}else{if(TS.has_pri[t])TS.log(t,"calling sound.stop()");r.stop()}else if(soundManager)TS.warn("sound is null: "+n+" window.Audio: "+window.Audio+" window.winssb: "+window.winssb+" soundManager.ok(): "+soundManager.ok()+" soundManager.html5Only: "+soundManager.html5Only+" soundManager.canPlayMIME('audio/mp3'): "+soundManager.canPlayMIME("audio/mp3"))},getNotificationSoundNameFromFilename:function e(t){var n=_.find(TS.boot_data.notification_sounds,{value:t});if(!n){TS.error("No notification sound found matching "+t);return}return n.label}});var e={};var t=37})()},4346:function(e,t){(function(){"use strict";TS.registerModule("bandwidth",{onStart:function e(){},promiseToCheckBandwidth:function e(){if(t)return t;t=n();t.catch(function(){t=null});return t}});var e;var t;function n(){return new Promise(function(t,n){e={base_url:(window.cdn_url||"")+"/beacons/boomerang1/",timeout:3e4,nruns:5,latency_runs:10,results:[],latencies:[],latency:null,runs_left:0,aborted:false,complete:false};e.images=[{name:"image-0.png",size:11483,timeout:1400},{name:"image-1.png",size:40658,timeout:1200},{name:"image-2.png",size:164897,timeout:1300},{name:"image-3.png",size:381756,timeout:1500},{name:"image-4.png",size:1234664,timeout:1200},{name:"image-5.png",size:4509613,timeout:1200},{name:"image-6.png",size:9084559,timeout:1200}];e.images.end=e.images.length;e.images.start=0;e.images.l={name:"image-l.gif",size:35,timeout:1e3};e.images.start=0;e.runs_left=e.nruns;e.latency_runs=10;e.results=[];e.latencies=[];e.latency=null;e.complete=false;e.aborted=false;e.ncmp=function(e,t){return e-t};e.iqr=function(e){var t=e.length-1;var n=(e[Math.floor(.25*t)]+e[Math.ceil(.25*t)])/2;var i=(e[Math.floor(.75*t)]+e[Math.ceil(.75*t)])/2;var r=[];var a;var o=1.5*(i-n);t+=1;for(a=0;a<t&&e[a]<i+o;a+=1)if(e[a]>n-o)r.push(e[a]);return r};e.calcLatency=function(){var e;var t;var n=0;var i=0;var r;var a;var o;var s;var l;l=this.iqr(this.latencies.sort(this.ncmp));t=l.length;for(e=1;e<t;e+=1){n+=l[e];i+=l[e]*l[e]}t-=1;r=Math.round(n/t);o=Math.sqrt(i/t-n*n/(t*t));s=(1.96*o/Math.sqrt(t)).toFixed(2);o=o.toFixed(2);t=l.length-1;a=Math.round((l[Math.floor(t/2)]+l[Math.ceil(t/2)])/2);return{mean:r,median:a,stddev:o,stderr:s}};e.calcBW=function(){var e;var t;var n=0;var i;var r=[];var a=[];var o=0;var s=0;var l=0;var c=0;var u;var d;var _;var f;var m;var g;var p;var h;var v;var S;var T;for(e=0;e<this.nruns;e+=1){if(!this.results[e]||!this.results[e].r)continue;i=this.results[e].r;v=0;for(t=i.length-1;t>=0&&v<3;t-=1){if("undefined"===typeof i[t])break;if(null===i[t].t)continue;n+=1;v+=1;S=1e3*this.images[t].size/i[t].t;r.push(S);T=1e3*this.images[t].size/(i[t].t-this.latency.mean);a.push(T)}}if(r.length>3){r=this.iqr(r.sort(this.ncmp));a=this.iqr(a.sort(this.ncmp))}else{r=r.sort(this.ncmp);a=a.sort(this.ncmp)}n=Math.max(r.length,a.length);for(e=0;e<n;e+=1){if(e<r.length){o+=r[e];s+=Math.pow(r[e],2)}if(e<a.length){l+=a[e];c+=Math.pow(a[e],2)}}n=r.length;u=Math.round(o/n);d=Math.sqrt(s/n-Math.pow(o/n,2));_=Math.round(1.96*d/Math.sqrt(n));d=Math.round(d);n=r.length-1;f=Math.round((r[Math.floor(n/2)]+r[Math.ceil(n/2)])/2);n=a.length;m=Math.round(l/n);g=Math.sqrt(c/n-Math.pow(l/n,2));p=(1.96*g/Math.sqrt(n)).toFixed(2);g=g.toFixed(2);n=a.length-1;h=Math.round((a[Math.floor(n/2)]+a[Math.ceil(n/2)])/2);return{mean:u,stddev:d,stderr:_,median:f,mean_corrected:m,stddev_corrected:g,stderr_corrected:p,median_corrected:h}};e.defer=function(e){var t=this;return setTimeout(function(){e.call(t);t=null},10)};e.loadImg=function(e,t,n){var i=this.base_url+this.images[e].name+"?t="+Date.now()+Math.random();var r=0;var a=0;var o=new Image;var s=this;o.onload=function(){o.onerror=null;o.onload=null;o=null;clearTimeout(r);if(n)n.call(s,e,a,t,true);n=null;s=null};o.onerror=function(){o.onerror=null;o.onload=null;o=null;clearTimeout(r);if(n)n.call(s,e,a,t,false);n=null;s=null};r=setTimeout(function(){if(n)n.call(s,e,a,t,null)},this.images[e].timeout+Math.min(400,this.latency?this.latency.mean:400));a=Date.now();o.src=i};e.latLoaded=function(e,t,n,i){if(n!==this.latency_runs+1)return;if(null!==i){var r=Date.now()-t;this.latencies.push(r)}if(0===this.latency_runs)this.latency=this.calcLatency();this.defer(this.iterate)};e.imgLoaded=function(e,t,n,i){if(n!==this.runs_left+1)return;if(this.results[this.nruns-n].r[e])return;if(null===i){this.results[this.nruns-n].r[e+1]={t:null,state:null,run:n};return}var r={start:t,end:Date.now(),t:null,state:i,run:n};if(i)r.t=r.end-r.start;this.results[this.nruns-n].r[e]=r;if(e>=this.images.end-1||"undefined"!==typeof this.results[this.nruns-n].r[e+1]){if(n===this.nruns)this.images.start=e;this.defer(this.iterate)}else this.loadImg(e+1,n,this.imgLoaded)};e.iterate=function(){if(this.aborted)return false;if(!this.runs_left)this.finish();else if(this.latency_runs){this.loadImg("l",this.latency_runs,this.latLoaded);this.latency_runs-=1}else{this.results.push({r:[]});this.loadImg(this.images.start,this.runs_left,this.imgLoaded);this.runs_left-=1}};e.finish=function(){if(!this.latency)this.latency=this.calcLatency();var i=this.calcBW();var r={bw:i.median_corrected,bw_err:parseFloat(i.stderr_corrected,10),lat:this.latency.mean,lat_err:parseFloat(this.latency.stderr,10)};if(isNaN(r.bw)||isNaN(r.lat)){r.kbps=0;r.mbps=0;n(new Error("bandwidth test failed"));return}r.kbps=Math.round(8*r.bw/1024);r.mbps=Math.round(10*r.kbps/1024)/10;if(e.timer)window.clearTimeout(e.timer);t(r)};e.timer=setTimeout(function(){e.aborted=true;e.finish()},e.timeout);e.defer(e.iterate)})}})()},4774:function(e,t){(function(){"use strict";TS.registerModule("channels.backfills",{onStart:function t(){e={}},updateBackfillingList:function t(n){var i=e[n.id];if(n.backfill_ends){if(!i)return;if("remove_default"===n.backfill_ends||i.backfill_starts===n.backfill_ends)delete e[n.id]}else if(n.backfill_starts){if(i)return;e[n.id]=n}},isBackfilling:function t(n){if(!TS.boot_data.feature_default_shared_channels)return false;return!!e[n]}});var e})()},4836:function(e,t,n){n(4334);n(4335);n(4336);n(4337);n(4338);n(4339);n(4340);n(4341);n(4342);n(4343);n(4344);n(4345);n(4346);n(4188);n(4324);n(4193);n(4194);n(4195);n(4322);n(4320);n(4319);n(3688);n(4298);n(4296);n(4292);n(4287);n(4283);n(4255);n(4253);n(4252);n(4251);n(4230);n(4218);n(4219);n(3689);n(4333);n(4774);n(4241);n(4311);n(4323);n(4259);n(4307);n(4264);n(4306);n(4268);n(4318);n(4277);n(4222);n(4315);n(4295);n(4312);n(4314);n(4303);n(4304);n(4279);n(4267);n(4260);n(4192);n(4227);n(4290);n(4276);e.exports=n(4300)}},[4836]);